{"ast":null,"code":"import { traverse, getSectionMetadatas, shiftSection } from \"@webassemblyjs/ast\";\nimport { overrideBytesInBuffer } from \"@webassemblyjs/helper-buffer\";\nexport function removeSections(ast, uint8Buffer, section) {\n  var sectionMetadatas = getSectionMetadatas(ast, section);\n\n  if (sectionMetadatas.length === 0) {\n    throw new Error(\"Section metadata not found\");\n  }\n\n  return sectionMetadatas.reverse().reduce(function (uint8Buffer, sectionMetadata) {\n    var startsIncludingId = sectionMetadata.startOffset - 1;\n    var ends = section === \"start\" ? sectionMetadata.size.loc.end.column + 1 : sectionMetadata.startOffset + sectionMetadata.size.value + 1;\n    var delta = -(ends - startsIncludingId);\n    /**\n     * update AST\n     */\n    // Once we hit our section every that is after needs to be shifted by the delta\n\n    var encounteredSection = false;\n    traverse(ast, {\n      SectionMetadata: function SectionMetadata(path) {\n        if (path.node.section === section) {\n          encounteredSection = true;\n          return path.remove();\n        }\n\n        if (encounteredSection === true) {\n          shiftSection(ast, path.node, delta);\n        }\n      }\n    }); // replacement is nothing\n\n    var replacement = [];\n    return overrideBytesInBuffer(uint8Buffer, startsIncludingId, ends, replacement);\n  }, uint8Buffer);\n}","map":{"version":3,"sources":["G:/0_coding/Side Project/photo-website/node_modules/@webassemblyjs/helper-wasm-section/esm/remove.js"],"names":["traverse","getSectionMetadatas","shiftSection","overrideBytesInBuffer","removeSections","ast","uint8Buffer","section","sectionMetadatas","length","Error","reverse","reduce","sectionMetadata","startsIncludingId","startOffset","ends","size","loc","end","column","value","delta","encounteredSection","SectionMetadata","path","node","remove","replacement"],"mappings":"AAAA,SAASA,QAAT,EAAmBC,mBAAnB,EAAwCC,YAAxC,QAA4D,oBAA5D;AACA,SAASC,qBAAT,QAAsC,8BAAtC;AACA,OAAO,SAASC,cAAT,CAAwBC,GAAxB,EAA6BC,WAA7B,EAA0CC,OAA1C,EAAmD;AACxD,MAAIC,gBAAgB,GAAGP,mBAAmB,CAACI,GAAD,EAAME,OAAN,CAA1C;;AAEA,MAAIC,gBAAgB,CAACC,MAAjB,KAA4B,CAAhC,EAAmC;AACjC,UAAM,IAAIC,KAAJ,CAAU,4BAAV,CAAN;AACD;;AAED,SAAOF,gBAAgB,CAACG,OAAjB,GAA2BC,MAA3B,CAAkC,UAAUN,WAAV,EAAuBO,eAAvB,EAAwC;AAC/E,QAAIC,iBAAiB,GAAGD,eAAe,CAACE,WAAhB,GAA8B,CAAtD;AACA,QAAIC,IAAI,GAAGT,OAAO,KAAK,OAAZ,GAAsBM,eAAe,CAACI,IAAhB,CAAqBC,GAArB,CAAyBC,GAAzB,CAA6BC,MAA7B,GAAsC,CAA5D,GAAgEP,eAAe,CAACE,WAAhB,GAA8BF,eAAe,CAACI,IAAhB,CAAqBI,KAAnD,GAA2D,CAAtI;AACA,QAAIC,KAAK,GAAG,EAAEN,IAAI,GAAGF,iBAAT,CAAZ;AACA;AACJ;AACA;AACI;;AAEA,QAAIS,kBAAkB,GAAG,KAAzB;AACAvB,IAAAA,QAAQ,CAACK,GAAD,EAAM;AACZmB,MAAAA,eAAe,EAAE,SAASA,eAAT,CAAyBC,IAAzB,EAA+B;AAC9C,YAAIA,IAAI,CAACC,IAAL,CAAUnB,OAAV,KAAsBA,OAA1B,EAAmC;AACjCgB,UAAAA,kBAAkB,GAAG,IAArB;AACA,iBAAOE,IAAI,CAACE,MAAL,EAAP;AACD;;AAED,YAAIJ,kBAAkB,KAAK,IAA3B,EAAiC;AAC/BrB,UAAAA,YAAY,CAACG,GAAD,EAAMoB,IAAI,CAACC,IAAX,EAAiBJ,KAAjB,CAAZ;AACD;AACF;AAVW,KAAN,CAAR,CAV+E,CAqB3E;;AAEJ,QAAIM,WAAW,GAAG,EAAlB;AACA,WAAOzB,qBAAqB,CAACG,WAAD,EAAcQ,iBAAd,EAAiCE,IAAjC,EAAuCY,WAAvC,CAA5B;AACD,GAzBM,EAyBJtB,WAzBI,CAAP;AA0BD","sourcesContent":["import { traverse, getSectionMetadatas, shiftSection } from \"@webassemblyjs/ast\";\nimport { overrideBytesInBuffer } from \"@webassemblyjs/helper-buffer\";\nexport function removeSections(ast, uint8Buffer, section) {\n  var sectionMetadatas = getSectionMetadatas(ast, section);\n\n  if (sectionMetadatas.length === 0) {\n    throw new Error(\"Section metadata not found\");\n  }\n\n  return sectionMetadatas.reverse().reduce(function (uint8Buffer, sectionMetadata) {\n    var startsIncludingId = sectionMetadata.startOffset - 1;\n    var ends = section === \"start\" ? sectionMetadata.size.loc.end.column + 1 : sectionMetadata.startOffset + sectionMetadata.size.value + 1;\n    var delta = -(ends - startsIncludingId);\n    /**\n     * update AST\n     */\n    // Once we hit our section every that is after needs to be shifted by the delta\n\n    var encounteredSection = false;\n    traverse(ast, {\n      SectionMetadata: function SectionMetadata(path) {\n        if (path.node.section === section) {\n          encounteredSection = true;\n          return path.remove();\n        }\n\n        if (encounteredSection === true) {\n          shiftSection(ast, path.node, delta);\n        }\n      }\n    }); // replacement is nothing\n\n    var replacement = [];\n    return overrideBytesInBuffer(uint8Buffer, startsIncludingId, ends, replacement);\n  }, uint8Buffer);\n}"]},"metadata":{},"sourceType":"module"}