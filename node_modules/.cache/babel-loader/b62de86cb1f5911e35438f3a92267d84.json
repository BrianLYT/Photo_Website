{"ast":null,"code":"/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n\"use strict\";\n\nconst getWatcherManager = require(\"./getWatcherManager\");\n\nconst LinkResolver = require(\"./LinkResolver\");\n\nconst EventEmitter = require(\"events\").EventEmitter;\n\nconst globToRegExp = require(\"glob-to-regexp\");\n\nconst watchEventSource = require(\"./watchEventSource\");\n\nconst EMPTY_ARRAY = [];\nconst EMPTY_OPTIONS = {};\n\nfunction addWatchersToSet(watchers, set) {\n  for (const ww of watchers) {\n    const w = ww.watcher;\n\n    if (!set.has(w.directoryWatcher)) {\n      set.add(w.directoryWatcher);\n    }\n  }\n}\n\nconst stringToRegexp = ignored => {\n  const source = globToRegExp(ignored, {\n    globstar: true,\n    extended: true\n  }).source;\n  const matchingStart = source.slice(0, source.length - 1) + \"(?:$|\\\\/)\";\n  return matchingStart;\n};\n\nconst ignoredToFunction = ignored => {\n  if (Array.isArray(ignored)) {\n    const regexp = new RegExp(ignored.map(i => stringToRegexp(i)).join(\"|\"));\n    return x => regexp.test(x.replace(/\\\\/g, \"/\"));\n  } else if (typeof ignored === \"string\") {\n    const regexp = new RegExp(stringToRegexp(ignored));\n    return x => regexp.test(x.replace(/\\\\/g, \"/\"));\n  } else if (ignored instanceof RegExp) {\n    return x => ignored.test(x.replace(/\\\\/g, \"/\"));\n  } else if (ignored instanceof Function) {\n    return ignored;\n  } else if (ignored) {\n    throw new Error(`Invalid option for 'ignored': ${ignored}`);\n  } else {\n    return () => false;\n  }\n};\n\nconst normalizeOptions = options => {\n  return {\n    followSymlinks: !!options.followSymlinks,\n    ignored: ignoredToFunction(options.ignored),\n    poll: options.poll\n  };\n};\n\nconst normalizeCache = new WeakMap();\n\nconst cachedNormalizeOptions = options => {\n  const cacheEntry = normalizeCache.get(options);\n  if (cacheEntry !== undefined) return cacheEntry;\n  const normalized = normalizeOptions(options);\n  normalizeCache.set(options, normalized);\n  return normalized;\n};\n\nclass WatchpackFileWatcher {\n  constructor(watchpack, watcher, files) {\n    this.files = Array.isArray(files) ? files : [files];\n    this.watcher = watcher;\n    watcher.on(\"initial-missing\", type => {\n      for (const file of this.files) {\n        if (!watchpack._missing.has(file)) watchpack._onRemove(file, file, type);\n      }\n    });\n    watcher.on(\"change\", (mtime, type) => {\n      for (const file of this.files) {\n        watchpack._onChange(file, mtime, file, type);\n      }\n    });\n    watcher.on(\"remove\", type => {\n      for (const file of this.files) {\n        watchpack._onRemove(file, file, type);\n      }\n    });\n  }\n\n  update(files) {\n    if (!Array.isArray(files)) {\n      if (this.files.length !== 1) {\n        this.files = [files];\n      } else if (this.files[0] !== files) {\n        this.files[0] = files;\n      }\n    } else {\n      this.files = files;\n    }\n  }\n\n  close() {\n    this.watcher.close();\n  }\n\n}\n\nclass WatchpackDirectoryWatcher {\n  constructor(watchpack, watcher, directories) {\n    this.directories = Array.isArray(directories) ? directories : [directories];\n    this.watcher = watcher;\n    watcher.on(\"initial-missing\", type => {\n      for (const item of this.directories) {\n        watchpack._onRemove(item, item, type);\n      }\n    });\n    watcher.on(\"change\", (file, mtime, type) => {\n      for (const item of this.directories) {\n        watchpack._onChange(item, mtime, file, type);\n      }\n    });\n    watcher.on(\"remove\", type => {\n      for (const item of this.directories) {\n        watchpack._onRemove(item, item, type);\n      }\n    });\n  }\n\n  update(directories) {\n    if (!Array.isArray(directories)) {\n      if (this.directories.length !== 1) {\n        this.directories = [directories];\n      } else if (this.directories[0] !== directories) {\n        this.directories[0] = directories;\n      }\n    } else {\n      this.directories = directories;\n    }\n  }\n\n  close() {\n    this.watcher.close();\n  }\n\n}\n\nclass Watchpack extends EventEmitter {\n  constructor(options) {\n    super();\n    if (!options) options = EMPTY_OPTIONS;\n    this.options = options;\n    this.aggregateTimeout = typeof options.aggregateTimeout === \"number\" ? options.aggregateTimeout : 200;\n    this.watcherOptions = cachedNormalizeOptions(options);\n    this.watcherManager = getWatcherManager(this.watcherOptions);\n    this.fileWatchers = new Map();\n    this.directoryWatchers = new Map();\n    this._missing = new Set();\n    this.startTime = undefined;\n    this.paused = false;\n    this.aggregatedChanges = new Set();\n    this.aggregatedRemovals = new Set();\n    this.aggregateTimer = undefined;\n    this._onTimeout = this._onTimeout.bind(this);\n  }\n\n  watch(arg1, arg2, arg3) {\n    let files, directories, missing, startTime;\n\n    if (!arg2) {\n      ({\n        files = EMPTY_ARRAY,\n        directories = EMPTY_ARRAY,\n        missing = EMPTY_ARRAY,\n        startTime\n      } = arg1);\n    } else {\n      files = arg1;\n      directories = arg2;\n      missing = EMPTY_ARRAY;\n      startTime = arg3;\n    }\n\n    this.paused = false;\n    const fileWatchers = this.fileWatchers;\n    const directoryWatchers = this.directoryWatchers;\n    const ignored = this.watcherOptions.ignored;\n\n    const filter = path => !ignored(path);\n\n    const addToMap = (map, key, item) => {\n      const list = map.get(key);\n\n      if (list === undefined) {\n        map.set(key, item);\n      } else if (Array.isArray(list)) {\n        list.push(item);\n      } else {\n        map.set(key, [list, item]);\n      }\n    };\n\n    const fileWatchersNeeded = new Map();\n    const directoryWatchersNeeded = new Map();\n    const missingFiles = new Set();\n\n    if (this.watcherOptions.followSymlinks) {\n      const resolver = new LinkResolver();\n\n      for (const file of files) {\n        if (filter(file)) {\n          for (const innerFile of resolver.resolve(file)) {\n            if (file === innerFile || filter(innerFile)) {\n              addToMap(fileWatchersNeeded, innerFile, file);\n            }\n          }\n        }\n      }\n\n      for (const file of missing) {\n        if (filter(file)) {\n          for (const innerFile of resolver.resolve(file)) {\n            if (file === innerFile || filter(innerFile)) {\n              missingFiles.add(file);\n              addToMap(fileWatchersNeeded, innerFile, file);\n            }\n          }\n        }\n      }\n\n      for (const dir of directories) {\n        if (filter(dir)) {\n          let first = true;\n\n          for (const innerItem of resolver.resolve(dir)) {\n            if (filter(innerItem)) {\n              addToMap(first ? directoryWatchersNeeded : fileWatchersNeeded, innerItem, dir);\n            }\n\n            first = false;\n          }\n        }\n      }\n    } else {\n      for (const file of files) {\n        if (filter(file)) {\n          addToMap(fileWatchersNeeded, file, file);\n        }\n      }\n\n      for (const file of missing) {\n        if (filter(file)) {\n          missingFiles.add(file);\n          addToMap(fileWatchersNeeded, file, file);\n        }\n      }\n\n      for (const dir of directories) {\n        if (filter(dir)) {\n          addToMap(directoryWatchersNeeded, dir, dir);\n        }\n      }\n    } // Close unneeded old watchers\n    // and update existing watchers\n\n\n    for (const [key, w] of fileWatchers) {\n      const needed = fileWatchersNeeded.get(key);\n\n      if (needed === undefined) {\n        w.close();\n        fileWatchers.delete(key);\n      } else {\n        w.update(needed);\n        fileWatchersNeeded.delete(key);\n      }\n    }\n\n    for (const [key, w] of directoryWatchers) {\n      const needed = directoryWatchersNeeded.get(key);\n\n      if (needed === undefined) {\n        w.close();\n        directoryWatchers.delete(key);\n      } else {\n        w.update(needed);\n        directoryWatchersNeeded.delete(key);\n      }\n    } // Create new watchers and install handlers on these watchers\n\n\n    watchEventSource.batch(() => {\n      for (const [key, files] of fileWatchersNeeded) {\n        const watcher = this.watcherManager.watchFile(key, startTime);\n\n        if (watcher) {\n          fileWatchers.set(key, new WatchpackFileWatcher(this, watcher, files));\n        }\n      }\n\n      for (const [key, directories] of directoryWatchersNeeded) {\n        const watcher = this.watcherManager.watchDirectory(key, startTime);\n\n        if (watcher) {\n          directoryWatchers.set(key, new WatchpackDirectoryWatcher(this, watcher, directories));\n        }\n      }\n    });\n    this._missing = missingFiles;\n    this.startTime = startTime;\n  }\n\n  close() {\n    this.paused = true;\n    if (this.aggregateTimer) clearTimeout(this.aggregateTimer);\n\n    for (const w of this.fileWatchers.values()) w.close();\n\n    for (const w of this.directoryWatchers.values()) w.close();\n\n    this.fileWatchers.clear();\n    this.directoryWatchers.clear();\n  }\n\n  pause() {\n    this.paused = true;\n    if (this.aggregateTimer) clearTimeout(this.aggregateTimer);\n  }\n\n  getTimes() {\n    const directoryWatchers = new Set();\n    addWatchersToSet(this.fileWatchers.values(), directoryWatchers);\n    addWatchersToSet(this.directoryWatchers.values(), directoryWatchers);\n    const obj = Object.create(null);\n\n    for (const w of directoryWatchers) {\n      const times = w.getTimes();\n\n      for (const file of Object.keys(times)) obj[file] = times[file];\n    }\n\n    return obj;\n  }\n\n  getTimeInfoEntries() {\n    const map = new Map();\n    this.collectTimeInfoEntries(map, map);\n    return map;\n  }\n\n  collectTimeInfoEntries(fileTimestamps, directoryTimestamps) {\n    const allWatchers = new Set();\n    addWatchersToSet(this.fileWatchers.values(), allWatchers);\n    addWatchersToSet(this.directoryWatchers.values(), allWatchers);\n    const safeTime = {\n      value: 0\n    };\n\n    for (const w of allWatchers) {\n      w.collectTimeInfoEntries(fileTimestamps, directoryTimestamps, safeTime);\n    }\n  }\n\n  getAggregated() {\n    if (this.aggregateTimer) {\n      clearTimeout(this.aggregateTimer);\n      this.aggregateTimer = undefined;\n    }\n\n    const changes = this.aggregatedChanges;\n    const removals = this.aggregatedRemovals;\n    this.aggregatedChanges = new Set();\n    this.aggregatedRemovals = new Set();\n    return {\n      changes,\n      removals\n    };\n  }\n\n  _onChange(item, mtime, file, type) {\n    file = file || item;\n\n    if (!this.paused) {\n      this.emit(\"change\", file, mtime, type);\n      if (this.aggregateTimer) clearTimeout(this.aggregateTimer);\n      this.aggregateTimer = setTimeout(this._onTimeout, this.aggregateTimeout);\n    }\n\n    this.aggregatedRemovals.delete(item);\n    this.aggregatedChanges.add(item);\n  }\n\n  _onRemove(item, file, type) {\n    file = file || item;\n\n    if (!this.paused) {\n      this.emit(\"remove\", file, type);\n      if (this.aggregateTimer) clearTimeout(this.aggregateTimer);\n      this.aggregateTimer = setTimeout(this._onTimeout, this.aggregateTimeout);\n    }\n\n    this.aggregatedChanges.delete(item);\n    this.aggregatedRemovals.add(item);\n  }\n\n  _onTimeout() {\n    this.aggregateTimer = undefined;\n    const changes = this.aggregatedChanges;\n    const removals = this.aggregatedRemovals;\n    this.aggregatedChanges = new Set();\n    this.aggregatedRemovals = new Set();\n    this.emit(\"aggregated\", changes, removals);\n  }\n\n}\n\nmodule.exports = Watchpack;","map":{"version":3,"sources":["G:/0_coding/Side Project/photo-website/node_modules/watchpack/lib/watchpack.js"],"names":["getWatcherManager","require","LinkResolver","EventEmitter","globToRegExp","watchEventSource","EMPTY_ARRAY","EMPTY_OPTIONS","addWatchersToSet","watchers","set","ww","w","watcher","has","directoryWatcher","add","stringToRegexp","ignored","source","globstar","extended","matchingStart","slice","length","ignoredToFunction","Array","isArray","regexp","RegExp","map","i","join","x","test","replace","Function","Error","normalizeOptions","options","followSymlinks","poll","normalizeCache","WeakMap","cachedNormalizeOptions","cacheEntry","get","undefined","normalized","WatchpackFileWatcher","constructor","watchpack","files","on","type","file","_missing","_onRemove","mtime","_onChange","update","close","WatchpackDirectoryWatcher","directories","item","Watchpack","aggregateTimeout","watcherOptions","watcherManager","fileWatchers","Map","directoryWatchers","Set","startTime","paused","aggregatedChanges","aggregatedRemovals","aggregateTimer","_onTimeout","bind","watch","arg1","arg2","arg3","missing","filter","path","addToMap","key","list","push","fileWatchersNeeded","directoryWatchersNeeded","missingFiles","resolver","innerFile","resolve","dir","first","innerItem","needed","delete","batch","watchFile","watchDirectory","clearTimeout","values","clear","pause","getTimes","obj","Object","create","times","keys","getTimeInfoEntries","collectTimeInfoEntries","fileTimestamps","directoryTimestamps","allWatchers","safeTime","value","getAggregated","changes","removals","emit","setTimeout","module","exports"],"mappings":"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","sourcesContent":["/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n\"use strict\";\n\nconst getWatcherManager = require(\"./getWatcherManager\");\nconst LinkResolver = require(\"./LinkResolver\");\nconst EventEmitter = require(\"events\").EventEmitter;\nconst globToRegExp = require(\"glob-to-regexp\");\nconst watchEventSource = require(\"./watchEventSource\");\n\nconst EMPTY_ARRAY = [];\nconst EMPTY_OPTIONS = {};\n\nfunction addWatchersToSet(watchers, set) {\n\tfor (const ww of watchers) {\n\t\tconst w = ww.watcher;\n\t\tif (!set.has(w.directoryWatcher)) {\n\t\t\tset.add(w.directoryWatcher);\n\t\t}\n\t}\n}\n\nconst stringToRegexp = ignored => {\n\tconst source = globToRegExp(ignored, { globstar: true, extended: true })\n\t\t.source;\n\tconst matchingStart = source.slice(0, source.length - 1) + \"(?:$|\\\\/)\";\n\treturn matchingStart;\n};\n\nconst ignoredToFunction = ignored => {\n\tif (Array.isArray(ignored)) {\n\t\tconst regexp = new RegExp(ignored.map(i => stringToRegexp(i)).join(\"|\"));\n\t\treturn x => regexp.test(x.replace(/\\\\/g, \"/\"));\n\t} else if (typeof ignored === \"string\") {\n\t\tconst regexp = new RegExp(stringToRegexp(ignored));\n\t\treturn x => regexp.test(x.replace(/\\\\/g, \"/\"));\n\t} else if (ignored instanceof RegExp) {\n\t\treturn x => ignored.test(x.replace(/\\\\/g, \"/\"));\n\t} else if (ignored instanceof Function) {\n\t\treturn ignored;\n\t} else if (ignored) {\n\t\tthrow new Error(`Invalid option for 'ignored': ${ignored}`);\n\t} else {\n\t\treturn () => false;\n\t}\n};\n\nconst normalizeOptions = options => {\n\treturn {\n\t\tfollowSymlinks: !!options.followSymlinks,\n\t\tignored: ignoredToFunction(options.ignored),\n\t\tpoll: options.poll\n\t};\n};\n\nconst normalizeCache = new WeakMap();\nconst cachedNormalizeOptions = options => {\n\tconst cacheEntry = normalizeCache.get(options);\n\tif (cacheEntry !== undefined) return cacheEntry;\n\tconst normalized = normalizeOptions(options);\n\tnormalizeCache.set(options, normalized);\n\treturn normalized;\n};\n\nclass WatchpackFileWatcher {\n\tconstructor(watchpack, watcher, files) {\n\t\tthis.files = Array.isArray(files) ? files : [files];\n\t\tthis.watcher = watcher;\n\t\twatcher.on(\"initial-missing\", type => {\n\t\t\tfor (const file of this.files) {\n\t\t\t\tif (!watchpack._missing.has(file))\n\t\t\t\t\twatchpack._onRemove(file, file, type);\n\t\t\t}\n\t\t});\n\t\twatcher.on(\"change\", (mtime, type) => {\n\t\t\tfor (const file of this.files) {\n\t\t\t\twatchpack._onChange(file, mtime, file, type);\n\t\t\t}\n\t\t});\n\t\twatcher.on(\"remove\", type => {\n\t\t\tfor (const file of this.files) {\n\t\t\t\twatchpack._onRemove(file, file, type);\n\t\t\t}\n\t\t});\n\t}\n\n\tupdate(files) {\n\t\tif (!Array.isArray(files)) {\n\t\t\tif (this.files.length !== 1) {\n\t\t\t\tthis.files = [files];\n\t\t\t} else if (this.files[0] !== files) {\n\t\t\t\tthis.files[0] = files;\n\t\t\t}\n\t\t} else {\n\t\t\tthis.files = files;\n\t\t}\n\t}\n\n\tclose() {\n\t\tthis.watcher.close();\n\t}\n}\n\nclass WatchpackDirectoryWatcher {\n\tconstructor(watchpack, watcher, directories) {\n\t\tthis.directories = Array.isArray(directories) ? directories : [directories];\n\t\tthis.watcher = watcher;\n\t\twatcher.on(\"initial-missing\", type => {\n\t\t\tfor (const item of this.directories) {\n\t\t\t\twatchpack._onRemove(item, item, type);\n\t\t\t}\n\t\t});\n\t\twatcher.on(\"change\", (file, mtime, type) => {\n\t\t\tfor (const item of this.directories) {\n\t\t\t\twatchpack._onChange(item, mtime, file, type);\n\t\t\t}\n\t\t});\n\t\twatcher.on(\"remove\", type => {\n\t\t\tfor (const item of this.directories) {\n\t\t\t\twatchpack._onRemove(item, item, type);\n\t\t\t}\n\t\t});\n\t}\n\n\tupdate(directories) {\n\t\tif (!Array.isArray(directories)) {\n\t\t\tif (this.directories.length !== 1) {\n\t\t\t\tthis.directories = [directories];\n\t\t\t} else if (this.directories[0] !== directories) {\n\t\t\t\tthis.directories[0] = directories;\n\t\t\t}\n\t\t} else {\n\t\t\tthis.directories = directories;\n\t\t}\n\t}\n\n\tclose() {\n\t\tthis.watcher.close();\n\t}\n}\n\nclass Watchpack extends EventEmitter {\n\tconstructor(options) {\n\t\tsuper();\n\t\tif (!options) options = EMPTY_OPTIONS;\n\t\tthis.options = options;\n\t\tthis.aggregateTimeout =\n\t\t\ttypeof options.aggregateTimeout === \"number\"\n\t\t\t\t? options.aggregateTimeout\n\t\t\t\t: 200;\n\t\tthis.watcherOptions = cachedNormalizeOptions(options);\n\t\tthis.watcherManager = getWatcherManager(this.watcherOptions);\n\t\tthis.fileWatchers = new Map();\n\t\tthis.directoryWatchers = new Map();\n\t\tthis._missing = new Set();\n\t\tthis.startTime = undefined;\n\t\tthis.paused = false;\n\t\tthis.aggregatedChanges = new Set();\n\t\tthis.aggregatedRemovals = new Set();\n\t\tthis.aggregateTimer = undefined;\n\t\tthis._onTimeout = this._onTimeout.bind(this);\n\t}\n\n\twatch(arg1, arg2, arg3) {\n\t\tlet files, directories, missing, startTime;\n\t\tif (!arg2) {\n\t\t\t({\n\t\t\t\tfiles = EMPTY_ARRAY,\n\t\t\t\tdirectories = EMPTY_ARRAY,\n\t\t\t\tmissing = EMPTY_ARRAY,\n\t\t\t\tstartTime\n\t\t\t} = arg1);\n\t\t} else {\n\t\t\tfiles = arg1;\n\t\t\tdirectories = arg2;\n\t\t\tmissing = EMPTY_ARRAY;\n\t\t\tstartTime = arg3;\n\t\t}\n\t\tthis.paused = false;\n\t\tconst fileWatchers = this.fileWatchers;\n\t\tconst directoryWatchers = this.directoryWatchers;\n\t\tconst ignored = this.watcherOptions.ignored;\n\t\tconst filter = path => !ignored(path);\n\t\tconst addToMap = (map, key, item) => {\n\t\t\tconst list = map.get(key);\n\t\t\tif (list === undefined) {\n\t\t\t\tmap.set(key, item);\n\t\t\t} else if (Array.isArray(list)) {\n\t\t\t\tlist.push(item);\n\t\t\t} else {\n\t\t\t\tmap.set(key, [list, item]);\n\t\t\t}\n\t\t};\n\t\tconst fileWatchersNeeded = new Map();\n\t\tconst directoryWatchersNeeded = new Map();\n\t\tconst missingFiles = new Set();\n\t\tif (this.watcherOptions.followSymlinks) {\n\t\t\tconst resolver = new LinkResolver();\n\t\t\tfor (const file of files) {\n\t\t\t\tif (filter(file)) {\n\t\t\t\t\tfor (const innerFile of resolver.resolve(file)) {\n\t\t\t\t\t\tif (file === innerFile || filter(innerFile)) {\n\t\t\t\t\t\t\taddToMap(fileWatchersNeeded, innerFile, file);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (const file of missing) {\n\t\t\t\tif (filter(file)) {\n\t\t\t\t\tfor (const innerFile of resolver.resolve(file)) {\n\t\t\t\t\t\tif (file === innerFile || filter(innerFile)) {\n\t\t\t\t\t\t\tmissingFiles.add(file);\n\t\t\t\t\t\t\taddToMap(fileWatchersNeeded, innerFile, file);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (const dir of directories) {\n\t\t\t\tif (filter(dir)) {\n\t\t\t\t\tlet first = true;\n\t\t\t\t\tfor (const innerItem of resolver.resolve(dir)) {\n\t\t\t\t\t\tif (filter(innerItem)) {\n\t\t\t\t\t\t\taddToMap(\n\t\t\t\t\t\t\t\tfirst ? directoryWatchersNeeded : fileWatchersNeeded,\n\t\t\t\t\t\t\t\tinnerItem,\n\t\t\t\t\t\t\t\tdir\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfirst = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tfor (const file of files) {\n\t\t\t\tif (filter(file)) {\n\t\t\t\t\taddToMap(fileWatchersNeeded, file, file);\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (const file of missing) {\n\t\t\t\tif (filter(file)) {\n\t\t\t\t\tmissingFiles.add(file);\n\t\t\t\t\taddToMap(fileWatchersNeeded, file, file);\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (const dir of directories) {\n\t\t\t\tif (filter(dir)) {\n\t\t\t\t\taddToMap(directoryWatchersNeeded, dir, dir);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t// Close unneeded old watchers\n\t\t// and update existing watchers\n\t\tfor (const [key, w] of fileWatchers) {\n\t\t\tconst needed = fileWatchersNeeded.get(key);\n\t\t\tif (needed === undefined) {\n\t\t\t\tw.close();\n\t\t\t\tfileWatchers.delete(key);\n\t\t\t} else {\n\t\t\t\tw.update(needed);\n\t\t\t\tfileWatchersNeeded.delete(key);\n\t\t\t}\n\t\t}\n\t\tfor (const [key, w] of directoryWatchers) {\n\t\t\tconst needed = directoryWatchersNeeded.get(key);\n\t\t\tif (needed === undefined) {\n\t\t\t\tw.close();\n\t\t\t\tdirectoryWatchers.delete(key);\n\t\t\t} else {\n\t\t\t\tw.update(needed);\n\t\t\t\tdirectoryWatchersNeeded.delete(key);\n\t\t\t}\n\t\t}\n\t\t// Create new watchers and install handlers on these watchers\n\t\twatchEventSource.batch(() => {\n\t\t\tfor (const [key, files] of fileWatchersNeeded) {\n\t\t\t\tconst watcher = this.watcherManager.watchFile(key, startTime);\n\t\t\t\tif (watcher) {\n\t\t\t\t\tfileWatchers.set(key, new WatchpackFileWatcher(this, watcher, files));\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (const [key, directories] of directoryWatchersNeeded) {\n\t\t\t\tconst watcher = this.watcherManager.watchDirectory(key, startTime);\n\t\t\t\tif (watcher) {\n\t\t\t\t\tdirectoryWatchers.set(\n\t\t\t\t\t\tkey,\n\t\t\t\t\t\tnew WatchpackDirectoryWatcher(this, watcher, directories)\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis._missing = missingFiles;\n\t\tthis.startTime = startTime;\n\t}\n\n\tclose() {\n\t\tthis.paused = true;\n\t\tif (this.aggregateTimer) clearTimeout(this.aggregateTimer);\n\t\tfor (const w of this.fileWatchers.values()) w.close();\n\t\tfor (const w of this.directoryWatchers.values()) w.close();\n\t\tthis.fileWatchers.clear();\n\t\tthis.directoryWatchers.clear();\n\t}\n\n\tpause() {\n\t\tthis.paused = true;\n\t\tif (this.aggregateTimer) clearTimeout(this.aggregateTimer);\n\t}\n\n\tgetTimes() {\n\t\tconst directoryWatchers = new Set();\n\t\taddWatchersToSet(this.fileWatchers.values(), directoryWatchers);\n\t\taddWatchersToSet(this.directoryWatchers.values(), directoryWatchers);\n\t\tconst obj = Object.create(null);\n\t\tfor (const w of directoryWatchers) {\n\t\t\tconst times = w.getTimes();\n\t\t\tfor (const file of Object.keys(times)) obj[file] = times[file];\n\t\t}\n\t\treturn obj;\n\t}\n\n\tgetTimeInfoEntries() {\n\t\tconst map = new Map();\n\t\tthis.collectTimeInfoEntries(map, map);\n\t\treturn map;\n\t}\n\n\tcollectTimeInfoEntries(fileTimestamps, directoryTimestamps) {\n\t\tconst allWatchers = new Set();\n\t\taddWatchersToSet(this.fileWatchers.values(), allWatchers);\n\t\taddWatchersToSet(this.directoryWatchers.values(), allWatchers);\n\t\tconst safeTime = { value: 0 };\n\t\tfor (const w of allWatchers) {\n\t\t\tw.collectTimeInfoEntries(fileTimestamps, directoryTimestamps, safeTime);\n\t\t}\n\t}\n\n\tgetAggregated() {\n\t\tif (this.aggregateTimer) {\n\t\t\tclearTimeout(this.aggregateTimer);\n\t\t\tthis.aggregateTimer = undefined;\n\t\t}\n\t\tconst changes = this.aggregatedChanges;\n\t\tconst removals = this.aggregatedRemovals;\n\t\tthis.aggregatedChanges = new Set();\n\t\tthis.aggregatedRemovals = new Set();\n\t\treturn { changes, removals };\n\t}\n\n\t_onChange(item, mtime, file, type) {\n\t\tfile = file || item;\n\t\tif (!this.paused) {\n\t\t\tthis.emit(\"change\", file, mtime, type);\n\t\t\tif (this.aggregateTimer) clearTimeout(this.aggregateTimer);\n\t\t\tthis.aggregateTimer = setTimeout(this._onTimeout, this.aggregateTimeout);\n\t\t}\n\t\tthis.aggregatedRemovals.delete(item);\n\t\tthis.aggregatedChanges.add(item);\n\t}\n\n\t_onRemove(item, file, type) {\n\t\tfile = file || item;\n\t\tif (!this.paused) {\n\t\t\tthis.emit(\"remove\", file, type);\n\t\t\tif (this.aggregateTimer) clearTimeout(this.aggregateTimer);\n\t\t\tthis.aggregateTimer = setTimeout(this._onTimeout, this.aggregateTimeout);\n\t\t}\n\t\tthis.aggregatedChanges.delete(item);\n\t\tthis.aggregatedRemovals.add(item);\n\t}\n\n\t_onTimeout() {\n\t\tthis.aggregateTimer = undefined;\n\t\tconst changes = this.aggregatedChanges;\n\t\tconst removals = this.aggregatedRemovals;\n\t\tthis.aggregatedChanges = new Set();\n\t\tthis.aggregatedRemovals = new Set();\n\t\tthis.emit(\"aggregated\", changes, removals);\n\t}\n}\n\nmodule.exports = Watchpack;\n"]},"metadata":{},"sourceType":"script"}