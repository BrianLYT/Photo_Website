{"ast":null,"code":"/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n\"use strict\";\n\nconst RuntimeGlobals = require(\"../RuntimeGlobals\");\n\nconst RuntimeModule = require(\"../RuntimeModule\");\n\nconst SelfModuleFactory = require(\"../SelfModuleFactory\");\n\nconst Template = require(\"../Template\");\n\nconst CommonJsExportsDependency = require(\"./CommonJsExportsDependency\");\n\nconst CommonJsFullRequireDependency = require(\"./CommonJsFullRequireDependency\");\n\nconst CommonJsRequireContextDependency = require(\"./CommonJsRequireContextDependency\");\n\nconst CommonJsRequireDependency = require(\"./CommonJsRequireDependency\");\n\nconst CommonJsSelfReferenceDependency = require(\"./CommonJsSelfReferenceDependency\");\n\nconst ModuleDecoratorDependency = require(\"./ModuleDecoratorDependency\");\n\nconst RequireHeaderDependency = require(\"./RequireHeaderDependency\");\n\nconst RequireResolveContextDependency = require(\"./RequireResolveContextDependency\");\n\nconst RequireResolveDependency = require(\"./RequireResolveDependency\");\n\nconst RequireResolveHeaderDependency = require(\"./RequireResolveHeaderDependency\");\n\nconst RuntimeRequirementsDependency = require(\"./RuntimeRequirementsDependency\");\n\nconst CommonJsExportsParserPlugin = require(\"./CommonJsExportsParserPlugin\");\n\nconst CommonJsImportsParserPlugin = require(\"./CommonJsImportsParserPlugin\");\n\nconst {\n  evaluateToIdentifier,\n  toConstantDependency\n} = require(\"../javascript/JavascriptParserHelpers\");\n\nconst CommonJsExportRequireDependency = require(\"./CommonJsExportRequireDependency\");\n\nclass CommonJsPlugin {\n  apply(compiler) {\n    compiler.hooks.compilation.tap(\"CommonJsPlugin\", (compilation, _ref) => {\n      let {\n        contextModuleFactory,\n        normalModuleFactory\n      } = _ref;\n      compilation.dependencyFactories.set(CommonJsRequireDependency, normalModuleFactory);\n      compilation.dependencyTemplates.set(CommonJsRequireDependency, new CommonJsRequireDependency.Template());\n      compilation.dependencyFactories.set(CommonJsFullRequireDependency, normalModuleFactory);\n      compilation.dependencyTemplates.set(CommonJsFullRequireDependency, new CommonJsFullRequireDependency.Template());\n      compilation.dependencyFactories.set(CommonJsRequireContextDependency, contextModuleFactory);\n      compilation.dependencyTemplates.set(CommonJsRequireContextDependency, new CommonJsRequireContextDependency.Template());\n      compilation.dependencyFactories.set(RequireResolveDependency, normalModuleFactory);\n      compilation.dependencyTemplates.set(RequireResolveDependency, new RequireResolveDependency.Template());\n      compilation.dependencyFactories.set(RequireResolveContextDependency, contextModuleFactory);\n      compilation.dependencyTemplates.set(RequireResolveContextDependency, new RequireResolveContextDependency.Template());\n      compilation.dependencyTemplates.set(RequireResolveHeaderDependency, new RequireResolveHeaderDependency.Template());\n      compilation.dependencyTemplates.set(RequireHeaderDependency, new RequireHeaderDependency.Template());\n      compilation.dependencyTemplates.set(CommonJsExportsDependency, new CommonJsExportsDependency.Template());\n      compilation.dependencyFactories.set(CommonJsExportRequireDependency, normalModuleFactory);\n      compilation.dependencyTemplates.set(CommonJsExportRequireDependency, new CommonJsExportRequireDependency.Template());\n      const selfFactory = new SelfModuleFactory(compilation.moduleGraph);\n      compilation.dependencyFactories.set(CommonJsSelfReferenceDependency, selfFactory);\n      compilation.dependencyTemplates.set(CommonJsSelfReferenceDependency, new CommonJsSelfReferenceDependency.Template());\n      compilation.dependencyFactories.set(ModuleDecoratorDependency, selfFactory);\n      compilation.dependencyTemplates.set(ModuleDecoratorDependency, new ModuleDecoratorDependency.Template());\n      compilation.hooks.runtimeRequirementInModule.for(RuntimeGlobals.harmonyModuleDecorator).tap(\"CommonJsPlugin\", (module, set) => {\n        set.add(RuntimeGlobals.module);\n        set.add(RuntimeGlobals.requireScope);\n      });\n      compilation.hooks.runtimeRequirementInModule.for(RuntimeGlobals.nodeModuleDecorator).tap(\"CommonJsPlugin\", (module, set) => {\n        set.add(RuntimeGlobals.module);\n        set.add(RuntimeGlobals.requireScope);\n      });\n      compilation.hooks.runtimeRequirementInTree.for(RuntimeGlobals.harmonyModuleDecorator).tap(\"CommonJsPlugin\", (chunk, set) => {\n        compilation.addRuntimeModule(chunk, new HarmonyModuleDecoratorRuntimeModule());\n      });\n      compilation.hooks.runtimeRequirementInTree.for(RuntimeGlobals.nodeModuleDecorator).tap(\"CommonJsPlugin\", (chunk, set) => {\n        compilation.addRuntimeModule(chunk, new NodeModuleDecoratorRuntimeModule());\n      });\n\n      const handler = (parser, parserOptions) => {\n        if (parserOptions.commonjs !== undefined && !parserOptions.commonjs) return;\n        parser.hooks.typeof.for(\"module\").tap(\"CommonJsPlugin\", toConstantDependency(parser, JSON.stringify(\"object\")));\n        parser.hooks.expression.for(\"require.main\").tap(\"CommonJsPlugin\", toConstantDependency(parser, `${RuntimeGlobals.moduleCache}[${RuntimeGlobals.entryModuleId}]`, [RuntimeGlobals.moduleCache, RuntimeGlobals.entryModuleId]));\n        parser.hooks.expression.for(\"module.loaded\").tap(\"CommonJsPlugin\", expr => {\n          parser.state.module.buildInfo.moduleConcatenationBailout = \"module.loaded\";\n          const dep = new RuntimeRequirementsDependency([RuntimeGlobals.moduleLoaded]);\n          dep.loc = expr.loc;\n          parser.state.module.addPresentationalDependency(dep);\n          return true;\n        });\n        parser.hooks.expression.for(\"module.id\").tap(\"CommonJsPlugin\", expr => {\n          parser.state.module.buildInfo.moduleConcatenationBailout = \"module.id\";\n          const dep = new RuntimeRequirementsDependency([RuntimeGlobals.moduleId]);\n          dep.loc = expr.loc;\n          parser.state.module.addPresentationalDependency(dep);\n          return true;\n        });\n        parser.hooks.evaluateIdentifier.for(\"module.hot\").tap(\"CommonJsPlugin\", evaluateToIdentifier(\"module.hot\", \"module\", () => [\"hot\"], null));\n        new CommonJsImportsParserPlugin(parserOptions).apply(parser);\n        new CommonJsExportsParserPlugin(compilation.moduleGraph).apply(parser);\n      };\n\n      normalModuleFactory.hooks.parser.for(\"javascript/auto\").tap(\"CommonJsPlugin\", handler);\n      normalModuleFactory.hooks.parser.for(\"javascript/dynamic\").tap(\"CommonJsPlugin\", handler);\n    });\n  }\n\n}\n\nclass HarmonyModuleDecoratorRuntimeModule extends RuntimeModule {\n  constructor() {\n    super(\"harmony module decorator\");\n  }\n  /**\n   * @returns {string} runtime code\n   */\n\n\n  generate() {\n    const {\n      runtimeTemplate\n    } = this.compilation;\n    return Template.asString([`${RuntimeGlobals.harmonyModuleDecorator} = ${runtimeTemplate.basicFunction(\"module\", [\"module = Object.create(module);\", \"if (!module.children) module.children = [];\", \"Object.defineProperty(module, 'exports', {\", Template.indent([\"enumerable: true,\", `set: ${runtimeTemplate.basicFunction(\"\", [\"throw new Error('ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: ' + module.id);\"])}`]), \"});\", \"return module;\"])};`]);\n  }\n\n}\n\nclass NodeModuleDecoratorRuntimeModule extends RuntimeModule {\n  constructor() {\n    super(\"node module decorator\");\n  }\n  /**\n   * @returns {string} runtime code\n   */\n\n\n  generate() {\n    const {\n      runtimeTemplate\n    } = this.compilation;\n    return Template.asString([`${RuntimeGlobals.nodeModuleDecorator} = ${runtimeTemplate.basicFunction(\"module\", [\"module.paths = [];\", \"if (!module.children) module.children = [];\", \"return module;\"])};`]);\n  }\n\n}\n\nmodule.exports = CommonJsPlugin;","map":{"version":3,"sources":["G:/0_coding/Side Project/photo-website/node_modules/webpack/lib/dependencies/CommonJsPlugin.js"],"names":["RuntimeGlobals","require","RuntimeModule","SelfModuleFactory","Template","CommonJsExportsDependency","CommonJsFullRequireDependency","CommonJsRequireContextDependency","CommonJsRequireDependency","CommonJsSelfReferenceDependency","ModuleDecoratorDependency","RequireHeaderDependency","RequireResolveContextDependency","RequireResolveDependency","RequireResolveHeaderDependency","RuntimeRequirementsDependency","CommonJsExportsParserPlugin","CommonJsImportsParserPlugin","evaluateToIdentifier","toConstantDependency","CommonJsExportRequireDependency","CommonJsPlugin","apply","compiler","hooks","compilation","tap","contextModuleFactory","normalModuleFactory","dependencyFactories","set","dependencyTemplates","selfFactory","moduleGraph","runtimeRequirementInModule","for","harmonyModuleDecorator","module","add","requireScope","nodeModuleDecorator","runtimeRequirementInTree","chunk","addRuntimeModule","HarmonyModuleDecoratorRuntimeModule","NodeModuleDecoratorRuntimeModule","handler","parser","parserOptions","commonjs","undefined","typeof","JSON","stringify","expression","moduleCache","entryModuleId","expr","state","buildInfo","moduleConcatenationBailout","dep","moduleLoaded","loc","addPresentationalDependency","moduleId","evaluateIdentifier","constructor","generate","runtimeTemplate","asString","basicFunction","indent","exports"],"mappings":"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","sourcesContent":["/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n\n\"use strict\";\n\nconst RuntimeGlobals = require(\"../RuntimeGlobals\");\nconst RuntimeModule = require(\"../RuntimeModule\");\nconst SelfModuleFactory = require(\"../SelfModuleFactory\");\nconst Template = require(\"../Template\");\nconst CommonJsExportsDependency = require(\"./CommonJsExportsDependency\");\nconst CommonJsFullRequireDependency = require(\"./CommonJsFullRequireDependency\");\nconst CommonJsRequireContextDependency = require(\"./CommonJsRequireContextDependency\");\nconst CommonJsRequireDependency = require(\"./CommonJsRequireDependency\");\nconst CommonJsSelfReferenceDependency = require(\"./CommonJsSelfReferenceDependency\");\nconst ModuleDecoratorDependency = require(\"./ModuleDecoratorDependency\");\nconst RequireHeaderDependency = require(\"./RequireHeaderDependency\");\nconst RequireResolveContextDependency = require(\"./RequireResolveContextDependency\");\nconst RequireResolveDependency = require(\"./RequireResolveDependency\");\nconst RequireResolveHeaderDependency = require(\"./RequireResolveHeaderDependency\");\nconst RuntimeRequirementsDependency = require(\"./RuntimeRequirementsDependency\");\n\nconst CommonJsExportsParserPlugin = require(\"./CommonJsExportsParserPlugin\");\nconst CommonJsImportsParserPlugin = require(\"./CommonJsImportsParserPlugin\");\n\nconst {\n\tevaluateToIdentifier,\n\ttoConstantDependency\n} = require(\"../javascript/JavascriptParserHelpers\");\nconst CommonJsExportRequireDependency = require(\"./CommonJsExportRequireDependency\");\n\nclass CommonJsPlugin {\n\tapply(compiler) {\n\t\tcompiler.hooks.compilation.tap(\n\t\t\t\"CommonJsPlugin\",\n\t\t\t(compilation, { contextModuleFactory, normalModuleFactory }) => {\n\t\t\t\tcompilation.dependencyFactories.set(\n\t\t\t\t\tCommonJsRequireDependency,\n\t\t\t\t\tnormalModuleFactory\n\t\t\t\t);\n\t\t\t\tcompilation.dependencyTemplates.set(\n\t\t\t\t\tCommonJsRequireDependency,\n\t\t\t\t\tnew CommonJsRequireDependency.Template()\n\t\t\t\t);\n\n\t\t\t\tcompilation.dependencyFactories.set(\n\t\t\t\t\tCommonJsFullRequireDependency,\n\t\t\t\t\tnormalModuleFactory\n\t\t\t\t);\n\t\t\t\tcompilation.dependencyTemplates.set(\n\t\t\t\t\tCommonJsFullRequireDependency,\n\t\t\t\t\tnew CommonJsFullRequireDependency.Template()\n\t\t\t\t);\n\n\t\t\t\tcompilation.dependencyFactories.set(\n\t\t\t\t\tCommonJsRequireContextDependency,\n\t\t\t\t\tcontextModuleFactory\n\t\t\t\t);\n\t\t\t\tcompilation.dependencyTemplates.set(\n\t\t\t\t\tCommonJsRequireContextDependency,\n\t\t\t\t\tnew CommonJsRequireContextDependency.Template()\n\t\t\t\t);\n\n\t\t\t\tcompilation.dependencyFactories.set(\n\t\t\t\t\tRequireResolveDependency,\n\t\t\t\t\tnormalModuleFactory\n\t\t\t\t);\n\t\t\t\tcompilation.dependencyTemplates.set(\n\t\t\t\t\tRequireResolveDependency,\n\t\t\t\t\tnew RequireResolveDependency.Template()\n\t\t\t\t);\n\n\t\t\t\tcompilation.dependencyFactories.set(\n\t\t\t\t\tRequireResolveContextDependency,\n\t\t\t\t\tcontextModuleFactory\n\t\t\t\t);\n\t\t\t\tcompilation.dependencyTemplates.set(\n\t\t\t\t\tRequireResolveContextDependency,\n\t\t\t\t\tnew RequireResolveContextDependency.Template()\n\t\t\t\t);\n\n\t\t\t\tcompilation.dependencyTemplates.set(\n\t\t\t\t\tRequireResolveHeaderDependency,\n\t\t\t\t\tnew RequireResolveHeaderDependency.Template()\n\t\t\t\t);\n\n\t\t\t\tcompilation.dependencyTemplates.set(\n\t\t\t\t\tRequireHeaderDependency,\n\t\t\t\t\tnew RequireHeaderDependency.Template()\n\t\t\t\t);\n\n\t\t\t\tcompilation.dependencyTemplates.set(\n\t\t\t\t\tCommonJsExportsDependency,\n\t\t\t\t\tnew CommonJsExportsDependency.Template()\n\t\t\t\t);\n\n\t\t\t\tcompilation.dependencyFactories.set(\n\t\t\t\t\tCommonJsExportRequireDependency,\n\t\t\t\t\tnormalModuleFactory\n\t\t\t\t);\n\t\t\t\tcompilation.dependencyTemplates.set(\n\t\t\t\t\tCommonJsExportRequireDependency,\n\t\t\t\t\tnew CommonJsExportRequireDependency.Template()\n\t\t\t\t);\n\n\t\t\t\tconst selfFactory = new SelfModuleFactory(compilation.moduleGraph);\n\n\t\t\t\tcompilation.dependencyFactories.set(\n\t\t\t\t\tCommonJsSelfReferenceDependency,\n\t\t\t\t\tselfFactory\n\t\t\t\t);\n\t\t\t\tcompilation.dependencyTemplates.set(\n\t\t\t\t\tCommonJsSelfReferenceDependency,\n\t\t\t\t\tnew CommonJsSelfReferenceDependency.Template()\n\t\t\t\t);\n\n\t\t\t\tcompilation.dependencyFactories.set(\n\t\t\t\t\tModuleDecoratorDependency,\n\t\t\t\t\tselfFactory\n\t\t\t\t);\n\t\t\t\tcompilation.dependencyTemplates.set(\n\t\t\t\t\tModuleDecoratorDependency,\n\t\t\t\t\tnew ModuleDecoratorDependency.Template()\n\t\t\t\t);\n\n\t\t\t\tcompilation.hooks.runtimeRequirementInModule\n\t\t\t\t\t.for(RuntimeGlobals.harmonyModuleDecorator)\n\t\t\t\t\t.tap(\"CommonJsPlugin\", (module, set) => {\n\t\t\t\t\t\tset.add(RuntimeGlobals.module);\n\t\t\t\t\t\tset.add(RuntimeGlobals.requireScope);\n\t\t\t\t\t});\n\n\t\t\t\tcompilation.hooks.runtimeRequirementInModule\n\t\t\t\t\t.for(RuntimeGlobals.nodeModuleDecorator)\n\t\t\t\t\t.tap(\"CommonJsPlugin\", (module, set) => {\n\t\t\t\t\t\tset.add(RuntimeGlobals.module);\n\t\t\t\t\t\tset.add(RuntimeGlobals.requireScope);\n\t\t\t\t\t});\n\n\t\t\t\tcompilation.hooks.runtimeRequirementInTree\n\t\t\t\t\t.for(RuntimeGlobals.harmonyModuleDecorator)\n\t\t\t\t\t.tap(\"CommonJsPlugin\", (chunk, set) => {\n\t\t\t\t\t\tcompilation.addRuntimeModule(\n\t\t\t\t\t\t\tchunk,\n\t\t\t\t\t\t\tnew HarmonyModuleDecoratorRuntimeModule()\n\t\t\t\t\t\t);\n\t\t\t\t\t});\n\n\t\t\t\tcompilation.hooks.runtimeRequirementInTree\n\t\t\t\t\t.for(RuntimeGlobals.nodeModuleDecorator)\n\t\t\t\t\t.tap(\"CommonJsPlugin\", (chunk, set) => {\n\t\t\t\t\t\tcompilation.addRuntimeModule(\n\t\t\t\t\t\t\tchunk,\n\t\t\t\t\t\t\tnew NodeModuleDecoratorRuntimeModule()\n\t\t\t\t\t\t);\n\t\t\t\t\t});\n\n\t\t\t\tconst handler = (parser, parserOptions) => {\n\t\t\t\t\tif (parserOptions.commonjs !== undefined && !parserOptions.commonjs)\n\t\t\t\t\t\treturn;\n\t\t\t\t\tparser.hooks.typeof\n\t\t\t\t\t\t.for(\"module\")\n\t\t\t\t\t\t.tap(\n\t\t\t\t\t\t\t\"CommonJsPlugin\",\n\t\t\t\t\t\t\ttoConstantDependency(parser, JSON.stringify(\"object\"))\n\t\t\t\t\t\t);\n\n\t\t\t\t\tparser.hooks.expression\n\t\t\t\t\t\t.for(\"require.main\")\n\t\t\t\t\t\t.tap(\n\t\t\t\t\t\t\t\"CommonJsPlugin\",\n\t\t\t\t\t\t\ttoConstantDependency(\n\t\t\t\t\t\t\t\tparser,\n\t\t\t\t\t\t\t\t`${RuntimeGlobals.moduleCache}[${RuntimeGlobals.entryModuleId}]`,\n\t\t\t\t\t\t\t\t[RuntimeGlobals.moduleCache, RuntimeGlobals.entryModuleId]\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t);\n\t\t\t\t\tparser.hooks.expression\n\t\t\t\t\t\t.for(\"module.loaded\")\n\t\t\t\t\t\t.tap(\"CommonJsPlugin\", expr => {\n\t\t\t\t\t\t\tparser.state.module.buildInfo.moduleConcatenationBailout =\n\t\t\t\t\t\t\t\t\"module.loaded\";\n\t\t\t\t\t\t\tconst dep = new RuntimeRequirementsDependency([\n\t\t\t\t\t\t\t\tRuntimeGlobals.moduleLoaded\n\t\t\t\t\t\t\t]);\n\t\t\t\t\t\t\tdep.loc = expr.loc;\n\t\t\t\t\t\t\tparser.state.module.addPresentationalDependency(dep);\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t});\n\n\t\t\t\t\tparser.hooks.expression\n\t\t\t\t\t\t.for(\"module.id\")\n\t\t\t\t\t\t.tap(\"CommonJsPlugin\", expr => {\n\t\t\t\t\t\t\tparser.state.module.buildInfo.moduleConcatenationBailout =\n\t\t\t\t\t\t\t\t\"module.id\";\n\t\t\t\t\t\t\tconst dep = new RuntimeRequirementsDependency([\n\t\t\t\t\t\t\t\tRuntimeGlobals.moduleId\n\t\t\t\t\t\t\t]);\n\t\t\t\t\t\t\tdep.loc = expr.loc;\n\t\t\t\t\t\t\tparser.state.module.addPresentationalDependency(dep);\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t});\n\n\t\t\t\t\tparser.hooks.evaluateIdentifier.for(\"module.hot\").tap(\n\t\t\t\t\t\t\"CommonJsPlugin\",\n\t\t\t\t\t\tevaluateToIdentifier(\"module.hot\", \"module\", () => [\"hot\"], null)\n\t\t\t\t\t);\n\n\t\t\t\t\tnew CommonJsImportsParserPlugin(parserOptions).apply(parser);\n\t\t\t\t\tnew CommonJsExportsParserPlugin(compilation.moduleGraph).apply(\n\t\t\t\t\t\tparser\n\t\t\t\t\t);\n\t\t\t\t};\n\n\t\t\t\tnormalModuleFactory.hooks.parser\n\t\t\t\t\t.for(\"javascript/auto\")\n\t\t\t\t\t.tap(\"CommonJsPlugin\", handler);\n\t\t\t\tnormalModuleFactory.hooks.parser\n\t\t\t\t\t.for(\"javascript/dynamic\")\n\t\t\t\t\t.tap(\"CommonJsPlugin\", handler);\n\t\t\t}\n\t\t);\n\t}\n}\n\nclass HarmonyModuleDecoratorRuntimeModule extends RuntimeModule {\n\tconstructor() {\n\t\tsuper(\"harmony module decorator\");\n\t}\n\n\t/**\n\t * @returns {string} runtime code\n\t */\n\tgenerate() {\n\t\tconst { runtimeTemplate } = this.compilation;\n\t\treturn Template.asString([\n\t\t\t`${\n\t\t\t\tRuntimeGlobals.harmonyModuleDecorator\n\t\t\t} = ${runtimeTemplate.basicFunction(\"module\", [\n\t\t\t\t\"module = Object.create(module);\",\n\t\t\t\t\"if (!module.children) module.children = [];\",\n\t\t\t\t\"Object.defineProperty(module, 'exports', {\",\n\t\t\t\tTemplate.indent([\n\t\t\t\t\t\"enumerable: true,\",\n\t\t\t\t\t`set: ${runtimeTemplate.basicFunction(\"\", [\n\t\t\t\t\t\t\"throw new Error('ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: ' + module.id);\"\n\t\t\t\t\t])}`\n\t\t\t\t]),\n\t\t\t\t\"});\",\n\t\t\t\t\"return module;\"\n\t\t\t])};`\n\t\t]);\n\t}\n}\n\nclass NodeModuleDecoratorRuntimeModule extends RuntimeModule {\n\tconstructor() {\n\t\tsuper(\"node module decorator\");\n\t}\n\n\t/**\n\t * @returns {string} runtime code\n\t */\n\tgenerate() {\n\t\tconst { runtimeTemplate } = this.compilation;\n\t\treturn Template.asString([\n\t\t\t`${RuntimeGlobals.nodeModuleDecorator} = ${runtimeTemplate.basicFunction(\n\t\t\t\t\"module\",\n\t\t\t\t[\n\t\t\t\t\t\"module.paths = [];\",\n\t\t\t\t\t\"if (!module.children) module.children = [];\",\n\t\t\t\t\t\"return module;\"\n\t\t\t\t]\n\t\t\t)};`\n\t\t]);\n\t}\n}\n\nmodule.exports = CommonJsPlugin;\n"]},"metadata":{},"sourceType":"script"}