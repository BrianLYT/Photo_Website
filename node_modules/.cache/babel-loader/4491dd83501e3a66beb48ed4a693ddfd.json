{"ast":null,"code":"/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n\"use strict\";\n\nconst RuntimeGlobals = require(\"../RuntimeGlobals\");\n\nconst RuntimeModule = require(\"../RuntimeModule\");\n\nconst Template = require(\"../Template\");\n/** @typedef {import(\"./RemoteModule\")} RemoteModule */\n\n\nclass RemoteRuntimeModule extends RuntimeModule {\n  constructor() {\n    super(\"remotes loading\");\n  }\n  /**\n   * @returns {string} runtime code\n   */\n\n\n  generate() {\n    const {\n      compilation,\n      chunkGraph\n    } = this;\n    const {\n      runtimeTemplate,\n      moduleGraph\n    } = compilation;\n    const chunkToRemotesMapping = {};\n    const idToExternalAndNameMapping = {};\n\n    for (const chunk of this.chunk.getAllAsyncChunks()) {\n      const modules = chunkGraph.getChunkModulesIterableBySourceType(chunk, \"remote\");\n      if (!modules) continue;\n      const remotes = chunkToRemotesMapping[chunk.id] = [];\n\n      for (const m of modules) {\n        const module =\n        /** @type {RemoteModule} */\n        m;\n        const name = module.internalRequest;\n        const id = chunkGraph.getModuleId(module);\n        const shareScope = module.shareScope;\n        const dep = module.dependencies[0];\n        const externalModule = moduleGraph.getModule(dep);\n        const externalModuleId = externalModule && chunkGraph.getModuleId(externalModule);\n        remotes.push(id);\n        idToExternalAndNameMapping[id] = [shareScope, name, externalModuleId];\n      }\n    }\n\n    return Template.asString([`var chunkMapping = ${JSON.stringify(chunkToRemotesMapping, null, \"\\t\")};`, `var idToExternalAndNameMapping = ${JSON.stringify(idToExternalAndNameMapping, null, \"\\t\")};`, `${RuntimeGlobals.ensureChunkHandlers}.remotes = ${runtimeTemplate.basicFunction(\"chunkId, promises\", [`if(${RuntimeGlobals.hasOwnProperty}(chunkMapping, chunkId)) {`, Template.indent([`chunkMapping[chunkId].forEach(${runtimeTemplate.basicFunction(\"id\", [`var getScope = ${RuntimeGlobals.currentRemoteGetScope};`, \"if(!getScope) getScope = [];\", \"var data = idToExternalAndNameMapping[id];\", \"if(getScope.indexOf(data) >= 0) return;\", \"getScope.push(data);\", `if(data.p) return promises.push(data.p);`, `var onError = ${runtimeTemplate.basicFunction(\"error\", ['if(!error) error = new Error(\"Container missing\");', 'if(typeof error.message === \"string\")', Template.indent(`error.message += '\\\\nwhile loading \"' + data[1] + '\" from ' + data[2];`), `__webpack_modules__[id] = ${runtimeTemplate.basicFunction(\"\", [\"throw error;\"])}`, \"data.p = 0;\"])};`, `var handleFunction = ${runtimeTemplate.basicFunction(\"fn, arg1, arg2, d, next, first\", [\"try {\", Template.indent([\"var promise = fn(arg1, arg2);\", \"if(promise && promise.then) {\", Template.indent([`var p = promise.then(${runtimeTemplate.returningFunction(\"next(result, d)\", \"result\")}, onError);`, `if(first) promises.push(data.p = p); else return p;`]), \"} else {\", Template.indent([\"return next(promise, d, first);\"]), \"}\"]), \"} catch(error) {\", Template.indent([\"onError(error);\"]), \"}\"])}`, `var onExternal = ${runtimeTemplate.returningFunction(`external ? handleFunction(${RuntimeGlobals.initializeSharing}, data[0], 0, external, onInitialized, first) : onError()`, \"external, _, first\")};`, `var onInitialized = ${runtimeTemplate.returningFunction(`handleFunction(external.get, data[1], getScope, 0, onFactory, first)`, \"_, external, first\")};`, `var onFactory = ${runtimeTemplate.basicFunction(\"factory\", [\"data.p = 1;\", `__webpack_modules__[id] = ${runtimeTemplate.basicFunction(\"module\", [\"module.exports = factory();\"])}`])};`, \"handleFunction(__webpack_require__, data[2], 0, 0, onExternal, 1);\"])});`]), \"}\"])}`]);\n  }\n\n}\n\nmodule.exports = RemoteRuntimeModule;","map":{"version":3,"sources":["G:/0_coding/Side Project/photo-website/node_modules/webpack/lib/container/RemoteRuntimeModule.js"],"names":["RuntimeGlobals","require","RuntimeModule","Template","RemoteRuntimeModule","constructor","generate","compilation","chunkGraph","runtimeTemplate","moduleGraph","chunkToRemotesMapping","idToExternalAndNameMapping","chunk","getAllAsyncChunks","modules","getChunkModulesIterableBySourceType","remotes","id","m","module","name","internalRequest","getModuleId","shareScope","dep","dependencies","externalModule","getModule","externalModuleId","push","asString","JSON","stringify","ensureChunkHandlers","basicFunction","hasOwnProperty","indent","currentRemoteGetScope","returningFunction","initializeSharing","exports"],"mappings":"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","sourcesContent":["/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n\n\"use strict\";\n\nconst RuntimeGlobals = require(\"../RuntimeGlobals\");\nconst RuntimeModule = require(\"../RuntimeModule\");\nconst Template = require(\"../Template\");\n\n/** @typedef {import(\"./RemoteModule\")} RemoteModule */\n\nclass RemoteRuntimeModule extends RuntimeModule {\n\tconstructor() {\n\t\tsuper(\"remotes loading\");\n\t}\n\n\t/**\n\t * @returns {string} runtime code\n\t */\n\tgenerate() {\n\t\tconst { compilation, chunkGraph } = this;\n\t\tconst { runtimeTemplate, moduleGraph } = compilation;\n\t\tconst chunkToRemotesMapping = {};\n\t\tconst idToExternalAndNameMapping = {};\n\t\tfor (const chunk of this.chunk.getAllAsyncChunks()) {\n\t\t\tconst modules = chunkGraph.getChunkModulesIterableBySourceType(\n\t\t\t\tchunk,\n\t\t\t\t\"remote\"\n\t\t\t);\n\t\t\tif (!modules) continue;\n\t\t\tconst remotes = (chunkToRemotesMapping[chunk.id] = []);\n\t\t\tfor (const m of modules) {\n\t\t\t\tconst module = /** @type {RemoteModule} */ (m);\n\t\t\t\tconst name = module.internalRequest;\n\t\t\t\tconst id = chunkGraph.getModuleId(module);\n\t\t\t\tconst shareScope = module.shareScope;\n\t\t\t\tconst dep = module.dependencies[0];\n\t\t\t\tconst externalModule = moduleGraph.getModule(dep);\n\t\t\t\tconst externalModuleId =\n\t\t\t\t\texternalModule && chunkGraph.getModuleId(externalModule);\n\t\t\t\tremotes.push(id);\n\t\t\t\tidToExternalAndNameMapping[id] = [shareScope, name, externalModuleId];\n\t\t\t}\n\t\t}\n\t\treturn Template.asString([\n\t\t\t`var chunkMapping = ${JSON.stringify(\n\t\t\t\tchunkToRemotesMapping,\n\t\t\t\tnull,\n\t\t\t\t\"\\t\"\n\t\t\t)};`,\n\t\t\t`var idToExternalAndNameMapping = ${JSON.stringify(\n\t\t\t\tidToExternalAndNameMapping,\n\t\t\t\tnull,\n\t\t\t\t\"\\t\"\n\t\t\t)};`,\n\t\t\t`${\n\t\t\t\tRuntimeGlobals.ensureChunkHandlers\n\t\t\t}.remotes = ${runtimeTemplate.basicFunction(\"chunkId, promises\", [\n\t\t\t\t`if(${RuntimeGlobals.hasOwnProperty}(chunkMapping, chunkId)) {`,\n\t\t\t\tTemplate.indent([\n\t\t\t\t\t`chunkMapping[chunkId].forEach(${runtimeTemplate.basicFunction(\"id\", [\n\t\t\t\t\t\t`var getScope = ${RuntimeGlobals.currentRemoteGetScope};`,\n\t\t\t\t\t\t\"if(!getScope) getScope = [];\",\n\t\t\t\t\t\t\"var data = idToExternalAndNameMapping[id];\",\n\t\t\t\t\t\t\"if(getScope.indexOf(data) >= 0) return;\",\n\t\t\t\t\t\t\"getScope.push(data);\",\n\t\t\t\t\t\t`if(data.p) return promises.push(data.p);`,\n\t\t\t\t\t\t`var onError = ${runtimeTemplate.basicFunction(\"error\", [\n\t\t\t\t\t\t\t'if(!error) error = new Error(\"Container missing\");',\n\t\t\t\t\t\t\t'if(typeof error.message === \"string\")',\n\t\t\t\t\t\t\tTemplate.indent(\n\t\t\t\t\t\t\t\t`error.message += '\\\\nwhile loading \"' + data[1] + '\" from ' + data[2];`\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t`__webpack_modules__[id] = ${runtimeTemplate.basicFunction(\"\", [\n\t\t\t\t\t\t\t\t\"throw error;\"\n\t\t\t\t\t\t\t])}`,\n\t\t\t\t\t\t\t\"data.p = 0;\"\n\t\t\t\t\t\t])};`,\n\t\t\t\t\t\t`var handleFunction = ${runtimeTemplate.basicFunction(\n\t\t\t\t\t\t\t\"fn, arg1, arg2, d, next, first\",\n\t\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\t\"try {\",\n\t\t\t\t\t\t\t\tTemplate.indent([\n\t\t\t\t\t\t\t\t\t\"var promise = fn(arg1, arg2);\",\n\t\t\t\t\t\t\t\t\t\"if(promise && promise.then) {\",\n\t\t\t\t\t\t\t\t\tTemplate.indent([\n\t\t\t\t\t\t\t\t\t\t`var p = promise.then(${runtimeTemplate.returningFunction(\n\t\t\t\t\t\t\t\t\t\t\t\"next(result, d)\",\n\t\t\t\t\t\t\t\t\t\t\t\"result\"\n\t\t\t\t\t\t\t\t\t\t)}, onError);`,\n\t\t\t\t\t\t\t\t\t\t`if(first) promises.push(data.p = p); else return p;`\n\t\t\t\t\t\t\t\t\t]),\n\t\t\t\t\t\t\t\t\t\"} else {\",\n\t\t\t\t\t\t\t\t\tTemplate.indent([\"return next(promise, d, first);\"]),\n\t\t\t\t\t\t\t\t\t\"}\"\n\t\t\t\t\t\t\t\t]),\n\t\t\t\t\t\t\t\t\"} catch(error) {\",\n\t\t\t\t\t\t\t\tTemplate.indent([\"onError(error);\"]),\n\t\t\t\t\t\t\t\t\"}\"\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t)}`,\n\t\t\t\t\t\t`var onExternal = ${runtimeTemplate.returningFunction(\n\t\t\t\t\t\t\t`external ? handleFunction(${RuntimeGlobals.initializeSharing}, data[0], 0, external, onInitialized, first) : onError()`,\n\t\t\t\t\t\t\t\"external, _, first\"\n\t\t\t\t\t\t)};`,\n\t\t\t\t\t\t`var onInitialized = ${runtimeTemplate.returningFunction(\n\t\t\t\t\t\t\t`handleFunction(external.get, data[1], getScope, 0, onFactory, first)`,\n\t\t\t\t\t\t\t\"_, external, first\"\n\t\t\t\t\t\t)};`,\n\t\t\t\t\t\t`var onFactory = ${runtimeTemplate.basicFunction(\"factory\", [\n\t\t\t\t\t\t\t\"data.p = 1;\",\n\t\t\t\t\t\t\t`__webpack_modules__[id] = ${runtimeTemplate.basicFunction(\n\t\t\t\t\t\t\t\t\"module\",\n\t\t\t\t\t\t\t\t[\"module.exports = factory();\"]\n\t\t\t\t\t\t\t)}`\n\t\t\t\t\t\t])};`,\n\t\t\t\t\t\t\"handleFunction(__webpack_require__, data[2], 0, 0, onExternal, 1);\"\n\t\t\t\t\t])});`\n\t\t\t\t]),\n\t\t\t\t\"}\"\n\t\t\t])}`\n\t\t]);\n\t}\n}\n\nmodule.exports = RemoteRuntimeModule;\n"]},"metadata":{},"sourceType":"script"}