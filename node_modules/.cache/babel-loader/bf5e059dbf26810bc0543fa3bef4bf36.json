{"ast":null,"code":"/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\nvar fs = require(\"fs\");\n\nvar readFile = fs.readFile.bind(fs);\n\nvar loadLoader = require(\"./loadLoader\");\n\nfunction utf8BufferToString(buf) {\n  var str = buf.toString(\"utf-8\");\n\n  if (str.charCodeAt(0) === 0xFEFF) {\n    return str.substr(1);\n  } else {\n    return str;\n  }\n}\n\nconst PATH_QUERY_FRAGMENT_REGEXP = /^((?:\\0.|[^?#\\0])*)(\\?(?:\\0.|[^#\\0])*)?(#.*)?$/;\n/**\n * @param {string} str the path with query and fragment\n * @returns {{ path: string, query: string, fragment: string }} parsed parts\n */\n\nfunction parsePathQueryFragment(str) {\n  var match = PATH_QUERY_FRAGMENT_REGEXP.exec(str);\n  return {\n    path: match[1].replace(/\\0(.)/g, \"$1\"),\n    query: match[2] ? match[2].replace(/\\0(.)/g, \"$1\") : \"\",\n    fragment: match[3] || \"\"\n  };\n}\n\nfunction dirname(path) {\n  if (path === \"/\") return \"/\";\n  var i = path.lastIndexOf(\"/\");\n  var j = path.lastIndexOf(\"\\\\\");\n  var i2 = path.indexOf(\"/\");\n  var j2 = path.indexOf(\"\\\\\");\n  var idx = i > j ? i : j;\n  var idx2 = i > j ? i2 : j2;\n  if (idx < 0) return path;\n  if (idx === idx2) return path.substr(0, idx + 1);\n  return path.substr(0, idx);\n}\n\nfunction createLoaderObject(loader) {\n  var obj = {\n    path: null,\n    query: null,\n    fragment: null,\n    options: null,\n    ident: null,\n    normal: null,\n    pitch: null,\n    raw: null,\n    data: null,\n    pitchExecuted: false,\n    normalExecuted: false\n  };\n  Object.defineProperty(obj, \"request\", {\n    enumerable: true,\n    get: function () {\n      return obj.path.replace(/#/g, \"\\0#\") + obj.query.replace(/#/g, \"\\0#\") + obj.fragment;\n    },\n    set: function (value) {\n      if (typeof value === \"string\") {\n        var splittedRequest = parsePathQueryFragment(value);\n        obj.path = splittedRequest.path;\n        obj.query = splittedRequest.query;\n        obj.fragment = splittedRequest.fragment;\n        obj.options = undefined;\n        obj.ident = undefined;\n      } else {\n        if (!value.loader) throw new Error(\"request should be a string or object with loader and options (\" + JSON.stringify(value) + \")\");\n        obj.path = value.loader;\n        obj.fragment = value.fragment || \"\";\n        obj.type = value.type;\n        obj.options = value.options;\n        obj.ident = value.ident;\n        if (obj.options === null) obj.query = \"\";else if (obj.options === undefined) obj.query = \"\";else if (typeof obj.options === \"string\") obj.query = \"?\" + obj.options;else if (obj.ident) obj.query = \"??\" + obj.ident;else if (typeof obj.options === \"object\" && obj.options.ident) obj.query = \"??\" + obj.options.ident;else obj.query = \"?\" + JSON.stringify(obj.options);\n      }\n    }\n  });\n  obj.request = loader;\n\n  if (Object.preventExtensions) {\n    Object.preventExtensions(obj);\n  }\n\n  return obj;\n}\n\nfunction runSyncOrAsync(fn, context, args, callback) {\n  var isSync = true;\n  var isDone = false;\n  var isError = false; // internal error\n\n  var reportedError = false;\n\n  context.async = function async() {\n    if (isDone) {\n      if (reportedError) return; // ignore\n\n      throw new Error(\"async(): The callback was already called.\");\n    }\n\n    isSync = false;\n    return innerCallback;\n  };\n\n  var innerCallback = context.callback = function () {\n    if (isDone) {\n      if (reportedError) return; // ignore\n\n      throw new Error(\"callback(): The callback was already called.\");\n    }\n\n    isDone = true;\n    isSync = false;\n\n    try {\n      callback.apply(null, arguments);\n    } catch (e) {\n      isError = true;\n      throw e;\n    }\n  };\n\n  try {\n    var result = function LOADER_EXECUTION() {\n      return fn.apply(context, args);\n    }();\n\n    if (isSync) {\n      isDone = true;\n      if (result === undefined) return callback();\n\n      if (result && typeof result === \"object\" && typeof result.then === \"function\") {\n        return result.then(function (r) {\n          callback(null, r);\n        }, callback);\n      }\n\n      return callback(null, result);\n    }\n  } catch (e) {\n    if (isError) throw e;\n\n    if (isDone) {\n      // loader is already \"done\", so we cannot use the callback function\n      // for better debugging we print the error on the console\n      if (typeof e === \"object\" && e.stack) console.error(e.stack);else console.error(e);\n      return;\n    }\n\n    isDone = true;\n    reportedError = true;\n    callback(e);\n  }\n}\n\nfunction convertArgs(args, raw) {\n  if (!raw && Buffer.isBuffer(args[0])) args[0] = utf8BufferToString(args[0]);else if (raw && typeof args[0] === \"string\") args[0] = Buffer.from(args[0], \"utf-8\");\n}\n\nfunction iteratePitchingLoaders(options, loaderContext, callback) {\n  // abort after last loader\n  if (loaderContext.loaderIndex >= loaderContext.loaders.length) return processResource(options, loaderContext, callback);\n  var currentLoaderObject = loaderContext.loaders[loaderContext.loaderIndex]; // iterate\n\n  if (currentLoaderObject.pitchExecuted) {\n    loaderContext.loaderIndex++;\n    return iteratePitchingLoaders(options, loaderContext, callback);\n  } // load loader module\n\n\n  loadLoader(currentLoaderObject, function (err) {\n    if (err) {\n      loaderContext.cacheable(false);\n      return callback(err);\n    }\n\n    var fn = currentLoaderObject.pitch;\n    currentLoaderObject.pitchExecuted = true;\n    if (!fn) return iteratePitchingLoaders(options, loaderContext, callback);\n    runSyncOrAsync(fn, loaderContext, [loaderContext.remainingRequest, loaderContext.previousRequest, currentLoaderObject.data = {}], function (err) {\n      if (err) return callback(err);\n      var args = Array.prototype.slice.call(arguments, 1); // Determine whether to continue the pitching process based on\n      // argument values (as opposed to argument presence) in order\n      // to support synchronous and asynchronous usages.\n\n      var hasArg = args.some(function (value) {\n        return value !== undefined;\n      });\n\n      if (hasArg) {\n        loaderContext.loaderIndex--;\n        iterateNormalLoaders(options, loaderContext, args, callback);\n      } else {\n        iteratePitchingLoaders(options, loaderContext, callback);\n      }\n    });\n  });\n}\n\nfunction processResource(options, loaderContext, callback) {\n  // set loader index to last loader\n  loaderContext.loaderIndex = loaderContext.loaders.length - 1;\n  var resourcePath = loaderContext.resourcePath;\n\n  if (resourcePath) {\n    options.processResource(loaderContext, resourcePath, function (err, buffer) {\n      if (err) return callback(err);\n      options.resourceBuffer = buffer;\n      iterateNormalLoaders(options, loaderContext, [buffer], callback);\n    });\n  } else {\n    iterateNormalLoaders(options, loaderContext, [null], callback);\n  }\n}\n\nfunction iterateNormalLoaders(options, loaderContext, args, callback) {\n  if (loaderContext.loaderIndex < 0) return callback(null, args);\n  var currentLoaderObject = loaderContext.loaders[loaderContext.loaderIndex]; // iterate\n\n  if (currentLoaderObject.normalExecuted) {\n    loaderContext.loaderIndex--;\n    return iterateNormalLoaders(options, loaderContext, args, callback);\n  }\n\n  var fn = currentLoaderObject.normal;\n  currentLoaderObject.normalExecuted = true;\n\n  if (!fn) {\n    return iterateNormalLoaders(options, loaderContext, args, callback);\n  }\n\n  convertArgs(args, currentLoaderObject.raw);\n  runSyncOrAsync(fn, loaderContext, args, function (err) {\n    if (err) return callback(err);\n    var args = Array.prototype.slice.call(arguments, 1);\n    iterateNormalLoaders(options, loaderContext, args, callback);\n  });\n}\n\nexports.getContext = function getContext(resource) {\n  var path = parsePathQueryFragment(resource).path;\n  return dirname(path);\n};\n\nexports.runLoaders = function runLoaders(options, callback) {\n  // read options\n  var resource = options.resource || \"\";\n  var loaders = options.loaders || [];\n  var loaderContext = options.context || {};\n\n  var processResource = options.processResource || ((readResource, context, resource, callback) => {\n    context.addDependency(resource);\n    readResource(resource, callback);\n  }).bind(null, options.readResource || readFile); //\n\n\n  var splittedResource = resource && parsePathQueryFragment(resource);\n  var resourcePath = splittedResource ? splittedResource.path : undefined;\n  var resourceQuery = splittedResource ? splittedResource.query : undefined;\n  var resourceFragment = splittedResource ? splittedResource.fragment : undefined;\n  var contextDirectory = resourcePath ? dirname(resourcePath) : null; // execution state\n\n  var requestCacheable = true;\n  var fileDependencies = [];\n  var contextDependencies = [];\n  var missingDependencies = []; // prepare loader objects\n\n  loaders = loaders.map(createLoaderObject);\n  loaderContext.context = contextDirectory;\n  loaderContext.loaderIndex = 0;\n  loaderContext.loaders = loaders;\n  loaderContext.resourcePath = resourcePath;\n  loaderContext.resourceQuery = resourceQuery;\n  loaderContext.resourceFragment = resourceFragment;\n  loaderContext.async = null;\n  loaderContext.callback = null;\n\n  loaderContext.cacheable = function cacheable(flag) {\n    if (flag === false) {\n      requestCacheable = false;\n    }\n  };\n\n  loaderContext.dependency = loaderContext.addDependency = function addDependency(file) {\n    fileDependencies.push(file);\n  };\n\n  loaderContext.addContextDependency = function addContextDependency(context) {\n    contextDependencies.push(context);\n  };\n\n  loaderContext.addMissingDependency = function addMissingDependency(context) {\n    missingDependencies.push(context);\n  };\n\n  loaderContext.getDependencies = function getDependencies() {\n    return fileDependencies.slice();\n  };\n\n  loaderContext.getContextDependencies = function getContextDependencies() {\n    return contextDependencies.slice();\n  };\n\n  loaderContext.getMissingDependencies = function getMissingDependencies() {\n    return missingDependencies.slice();\n  };\n\n  loaderContext.clearDependencies = function clearDependencies() {\n    fileDependencies.length = 0;\n    contextDependencies.length = 0;\n    missingDependencies.length = 0;\n    requestCacheable = true;\n  };\n\n  Object.defineProperty(loaderContext, \"resource\", {\n    enumerable: true,\n    get: function () {\n      if (loaderContext.resourcePath === undefined) return undefined;\n      return loaderContext.resourcePath.replace(/#/g, \"\\0#\") + loaderContext.resourceQuery.replace(/#/g, \"\\0#\") + loaderContext.resourceFragment;\n    },\n    set: function (value) {\n      var splittedResource = value && parsePathQueryFragment(value);\n      loaderContext.resourcePath = splittedResource ? splittedResource.path : undefined;\n      loaderContext.resourceQuery = splittedResource ? splittedResource.query : undefined;\n      loaderContext.resourceFragment = splittedResource ? splittedResource.fragment : undefined;\n    }\n  });\n  Object.defineProperty(loaderContext, \"request\", {\n    enumerable: true,\n    get: function () {\n      return loaderContext.loaders.map(function (o) {\n        return o.request;\n      }).concat(loaderContext.resource || \"\").join(\"!\");\n    }\n  });\n  Object.defineProperty(loaderContext, \"remainingRequest\", {\n    enumerable: true,\n    get: function () {\n      if (loaderContext.loaderIndex >= loaderContext.loaders.length - 1 && !loaderContext.resource) return \"\";\n      return loaderContext.loaders.slice(loaderContext.loaderIndex + 1).map(function (o) {\n        return o.request;\n      }).concat(loaderContext.resource || \"\").join(\"!\");\n    }\n  });\n  Object.defineProperty(loaderContext, \"currentRequest\", {\n    enumerable: true,\n    get: function () {\n      return loaderContext.loaders.slice(loaderContext.loaderIndex).map(function (o) {\n        return o.request;\n      }).concat(loaderContext.resource || \"\").join(\"!\");\n    }\n  });\n  Object.defineProperty(loaderContext, \"previousRequest\", {\n    enumerable: true,\n    get: function () {\n      return loaderContext.loaders.slice(0, loaderContext.loaderIndex).map(function (o) {\n        return o.request;\n      }).join(\"!\");\n    }\n  });\n  Object.defineProperty(loaderContext, \"query\", {\n    enumerable: true,\n    get: function () {\n      var entry = loaderContext.loaders[loaderContext.loaderIndex];\n      return entry.options && typeof entry.options === \"object\" ? entry.options : entry.query;\n    }\n  });\n  Object.defineProperty(loaderContext, \"data\", {\n    enumerable: true,\n    get: function () {\n      return loaderContext.loaders[loaderContext.loaderIndex].data;\n    }\n  }); // finish loader context\n\n  if (Object.preventExtensions) {\n    Object.preventExtensions(loaderContext);\n  }\n\n  var processOptions = {\n    resourceBuffer: null,\n    processResource: processResource\n  };\n  iteratePitchingLoaders(processOptions, loaderContext, function (err, result) {\n    if (err) {\n      return callback(err, {\n        cacheable: requestCacheable,\n        fileDependencies: fileDependencies,\n        contextDependencies: contextDependencies,\n        missingDependencies: missingDependencies\n      });\n    }\n\n    callback(null, {\n      result: result,\n      resourceBuffer: processOptions.resourceBuffer,\n      cacheable: requestCacheable,\n      fileDependencies: fileDependencies,\n      contextDependencies: contextDependencies,\n      missingDependencies: missingDependencies\n    });\n  });\n};","map":{"version":3,"sources":["G:/0_coding/Side Project/photo-website/node_modules/loader-runner/lib/LoaderRunner.js"],"names":["fs","require","readFile","bind","loadLoader","utf8BufferToString","buf","str","toString","charCodeAt","substr","PATH_QUERY_FRAGMENT_REGEXP","parsePathQueryFragment","match","exec","path","replace","query","fragment","dirname","i","lastIndexOf","j","i2","indexOf","j2","idx","idx2","createLoaderObject","loader","obj","options","ident","normal","pitch","raw","data","pitchExecuted","normalExecuted","Object","defineProperty","enumerable","get","set","value","splittedRequest","undefined","Error","JSON","stringify","type","request","preventExtensions","runSyncOrAsync","fn","context","args","callback","isSync","isDone","isError","reportedError","async","innerCallback","apply","arguments","e","result","LOADER_EXECUTION","then","r","stack","console","error","convertArgs","Buffer","isBuffer","from","iteratePitchingLoaders","loaderContext","loaderIndex","loaders","length","processResource","currentLoaderObject","err","cacheable","remainingRequest","previousRequest","Array","prototype","slice","call","hasArg","some","iterateNormalLoaders","resourcePath","buffer","resourceBuffer","exports","getContext","resource","runLoaders","readResource","addDependency","splittedResource","resourceQuery","resourceFragment","contextDirectory","requestCacheable","fileDependencies","contextDependencies","missingDependencies","map","flag","dependency","file","push","addContextDependency","addMissingDependency","getDependencies","getContextDependencies","getMissingDependencies","clearDependencies","o","concat","join","entry","processOptions"],"mappings":"AAAA;AACA;AACA;AACA;AACA,IAAIA,EAAE,GAAGC,OAAO,CAAC,IAAD,CAAhB;;AACA,IAAIC,QAAQ,GAAGF,EAAE,CAACE,QAAH,CAAYC,IAAZ,CAAiBH,EAAjB,CAAf;;AACA,IAAII,UAAU,GAAGH,OAAO,CAAC,cAAD,CAAxB;;AAEA,SAASI,kBAAT,CAA4BC,GAA5B,EAAiC;AAChC,MAAIC,GAAG,GAAGD,GAAG,CAACE,QAAJ,CAAa,OAAb,CAAV;;AACA,MAAGD,GAAG,CAACE,UAAJ,CAAe,CAAf,MAAsB,MAAzB,EAAiC;AAChC,WAAOF,GAAG,CAACG,MAAJ,CAAW,CAAX,CAAP;AACA,GAFD,MAEO;AACN,WAAOH,GAAP;AACA;AACD;;AAED,MAAMI,0BAA0B,GAAG,gDAAnC;AAEA;AACA;AACA;AACA;;AACA,SAASC,sBAAT,CAAgCL,GAAhC,EAAqC;AACpC,MAAIM,KAAK,GAAGF,0BAA0B,CAACG,IAA3B,CAAgCP,GAAhC,CAAZ;AACA,SAAO;AACNQ,IAAAA,IAAI,EAAEF,KAAK,CAAC,CAAD,CAAL,CAASG,OAAT,CAAiB,QAAjB,EAA2B,IAA3B,CADA;AAENC,IAAAA,KAAK,EAAEJ,KAAK,CAAC,CAAD,CAAL,GAAWA,KAAK,CAAC,CAAD,CAAL,CAASG,OAAT,CAAiB,QAAjB,EAA2B,IAA3B,CAAX,GAA8C,EAF/C;AAGNE,IAAAA,QAAQ,EAAEL,KAAK,CAAC,CAAD,CAAL,IAAY;AAHhB,GAAP;AAKA;;AAED,SAASM,OAAT,CAAiBJ,IAAjB,EAAuB;AACtB,MAAGA,IAAI,KAAK,GAAZ,EAAiB,OAAO,GAAP;AACjB,MAAIK,CAAC,GAAGL,IAAI,CAACM,WAAL,CAAiB,GAAjB,CAAR;AACA,MAAIC,CAAC,GAAGP,IAAI,CAACM,WAAL,CAAiB,IAAjB,CAAR;AACA,MAAIE,EAAE,GAAGR,IAAI,CAACS,OAAL,CAAa,GAAb,CAAT;AACA,MAAIC,EAAE,GAAGV,IAAI,CAACS,OAAL,CAAa,IAAb,CAAT;AACA,MAAIE,GAAG,GAAGN,CAAC,GAAGE,CAAJ,GAAQF,CAAR,GAAYE,CAAtB;AACA,MAAIK,IAAI,GAAGP,CAAC,GAAGE,CAAJ,GAAQC,EAAR,GAAaE,EAAxB;AACA,MAAGC,GAAG,GAAG,CAAT,EAAY,OAAOX,IAAP;AACZ,MAAGW,GAAG,KAAKC,IAAX,EAAiB,OAAOZ,IAAI,CAACL,MAAL,CAAY,CAAZ,EAAegB,GAAG,GAAG,CAArB,CAAP;AACjB,SAAOX,IAAI,CAACL,MAAL,CAAY,CAAZ,EAAegB,GAAf,CAAP;AACA;;AAED,SAASE,kBAAT,CAA4BC,MAA5B,EAAoC;AACnC,MAAIC,GAAG,GAAG;AACTf,IAAAA,IAAI,EAAE,IADG;AAETE,IAAAA,KAAK,EAAE,IAFE;AAGTC,IAAAA,QAAQ,EAAE,IAHD;AAITa,IAAAA,OAAO,EAAE,IAJA;AAKTC,IAAAA,KAAK,EAAE,IALE;AAMTC,IAAAA,MAAM,EAAE,IANC;AAOTC,IAAAA,KAAK,EAAE,IAPE;AAQTC,IAAAA,GAAG,EAAE,IARI;AASTC,IAAAA,IAAI,EAAE,IATG;AAUTC,IAAAA,aAAa,EAAE,KAVN;AAWTC,IAAAA,cAAc,EAAE;AAXP,GAAV;AAaAC,EAAAA,MAAM,CAACC,cAAP,CAAsBV,GAAtB,EAA2B,SAA3B,EAAsC;AACrCW,IAAAA,UAAU,EAAE,IADyB;AAErCC,IAAAA,GAAG,EAAE,YAAW;AACf,aAAOZ,GAAG,CAACf,IAAJ,CAASC,OAAT,CAAiB,IAAjB,EAAuB,KAAvB,IAAgCc,GAAG,CAACb,KAAJ,CAAUD,OAAV,CAAkB,IAAlB,EAAwB,KAAxB,CAAhC,GAAiEc,GAAG,CAACZ,QAA5E;AACA,KAJoC;AAKrCyB,IAAAA,GAAG,EAAE,UAASC,KAAT,EAAgB;AACpB,UAAG,OAAOA,KAAP,KAAiB,QAApB,EAA8B;AAC7B,YAAIC,eAAe,GAAGjC,sBAAsB,CAACgC,KAAD,CAA5C;AACAd,QAAAA,GAAG,CAACf,IAAJ,GAAW8B,eAAe,CAAC9B,IAA3B;AACAe,QAAAA,GAAG,CAACb,KAAJ,GAAY4B,eAAe,CAAC5B,KAA5B;AACAa,QAAAA,GAAG,CAACZ,QAAJ,GAAe2B,eAAe,CAAC3B,QAA/B;AACAY,QAAAA,GAAG,CAACC,OAAJ,GAAce,SAAd;AACAhB,QAAAA,GAAG,CAACE,KAAJ,GAAYc,SAAZ;AACA,OAPD,MAOO;AACN,YAAG,CAACF,KAAK,CAACf,MAAV,EACC,MAAM,IAAIkB,KAAJ,CAAU,mEAAmEC,IAAI,CAACC,SAAL,CAAeL,KAAf,CAAnE,GAA2F,GAArG,CAAN;AACDd,QAAAA,GAAG,CAACf,IAAJ,GAAW6B,KAAK,CAACf,MAAjB;AACAC,QAAAA,GAAG,CAACZ,QAAJ,GAAe0B,KAAK,CAAC1B,QAAN,IAAkB,EAAjC;AACAY,QAAAA,GAAG,CAACoB,IAAJ,GAAWN,KAAK,CAACM,IAAjB;AACApB,QAAAA,GAAG,CAACC,OAAJ,GAAca,KAAK,CAACb,OAApB;AACAD,QAAAA,GAAG,CAACE,KAAJ,GAAYY,KAAK,CAACZ,KAAlB;AACA,YAAGF,GAAG,CAACC,OAAJ,KAAgB,IAAnB,EACCD,GAAG,CAACb,KAAJ,GAAY,EAAZ,CADD,KAEK,IAAGa,GAAG,CAACC,OAAJ,KAAgBe,SAAnB,EACJhB,GAAG,CAACb,KAAJ,GAAY,EAAZ,CADI,KAEA,IAAG,OAAOa,GAAG,CAACC,OAAX,KAAuB,QAA1B,EACJD,GAAG,CAACb,KAAJ,GAAY,MAAMa,GAAG,CAACC,OAAtB,CADI,KAEA,IAAGD,GAAG,CAACE,KAAP,EACJF,GAAG,CAACb,KAAJ,GAAY,OAAOa,GAAG,CAACE,KAAvB,CADI,KAEA,IAAG,OAAOF,GAAG,CAACC,OAAX,KAAuB,QAAvB,IAAmCD,GAAG,CAACC,OAAJ,CAAYC,KAAlD,EACJF,GAAG,CAACb,KAAJ,GAAY,OAAOa,GAAG,CAACC,OAAJ,CAAYC,KAA/B,CADI,KAGJF,GAAG,CAACb,KAAJ,GAAY,MAAM+B,IAAI,CAACC,SAAL,CAAenB,GAAG,CAACC,OAAnB,CAAlB;AACD;AACD;AAlCoC,GAAtC;AAoCAD,EAAAA,GAAG,CAACqB,OAAJ,GAActB,MAAd;;AACA,MAAGU,MAAM,CAACa,iBAAV,EAA6B;AAC5Bb,IAAAA,MAAM,CAACa,iBAAP,CAAyBtB,GAAzB;AACA;;AACD,SAAOA,GAAP;AACA;;AAED,SAASuB,cAAT,CAAwBC,EAAxB,EAA4BC,OAA5B,EAAqCC,IAArC,EAA2CC,QAA3C,EAAqD;AACpD,MAAIC,MAAM,GAAG,IAAb;AACA,MAAIC,MAAM,GAAG,KAAb;AACA,MAAIC,OAAO,GAAG,KAAd,CAHoD,CAG/B;;AACrB,MAAIC,aAAa,GAAG,KAApB;;AACAN,EAAAA,OAAO,CAACO,KAAR,GAAgB,SAASA,KAAT,GAAiB;AAChC,QAAGH,MAAH,EAAW;AACV,UAAGE,aAAH,EAAkB,OADR,CACgB;;AAC1B,YAAM,IAAId,KAAJ,CAAU,2CAAV,CAAN;AACA;;AACDW,IAAAA,MAAM,GAAG,KAAT;AACA,WAAOK,aAAP;AACA,GAPD;;AAQA,MAAIA,aAAa,GAAGR,OAAO,CAACE,QAAR,GAAmB,YAAW;AACjD,QAAGE,MAAH,EAAW;AACV,UAAGE,aAAH,EAAkB,OADR,CACgB;;AAC1B,YAAM,IAAId,KAAJ,CAAU,8CAAV,CAAN;AACA;;AACDY,IAAAA,MAAM,GAAG,IAAT;AACAD,IAAAA,MAAM,GAAG,KAAT;;AACA,QAAI;AACHD,MAAAA,QAAQ,CAACO,KAAT,CAAe,IAAf,EAAqBC,SAArB;AACA,KAFD,CAEE,OAAMC,CAAN,EAAS;AACVN,MAAAA,OAAO,GAAG,IAAV;AACA,YAAMM,CAAN;AACA;AACD,GAbD;;AAcA,MAAI;AACH,QAAIC,MAAM,GAAI,SAASC,gBAAT,GAA4B;AACzC,aAAOd,EAAE,CAACU,KAAH,CAAST,OAAT,EAAkBC,IAAlB,CAAP;AACA,KAFa,EAAd;;AAGA,QAAGE,MAAH,EAAW;AACVC,MAAAA,MAAM,GAAG,IAAT;AACA,UAAGQ,MAAM,KAAKrB,SAAd,EACC,OAAOW,QAAQ,EAAf;;AACD,UAAGU,MAAM,IAAI,OAAOA,MAAP,KAAkB,QAA5B,IAAwC,OAAOA,MAAM,CAACE,IAAd,KAAuB,UAAlE,EAA8E;AAC7E,eAAOF,MAAM,CAACE,IAAP,CAAY,UAASC,CAAT,EAAY;AAC9Bb,UAAAA,QAAQ,CAAC,IAAD,EAAOa,CAAP,CAAR;AACA,SAFM,EAEJb,QAFI,CAAP;AAGA;;AACD,aAAOA,QAAQ,CAAC,IAAD,EAAOU,MAAP,CAAf;AACA;AACD,GAfD,CAeE,OAAMD,CAAN,EAAS;AACV,QAAGN,OAAH,EAAY,MAAMM,CAAN;;AACZ,QAAGP,MAAH,EAAW;AACV;AACA;AACA,UAAG,OAAOO,CAAP,KAAa,QAAb,IAAyBA,CAAC,CAACK,KAA9B,EAAqCC,OAAO,CAACC,KAAR,CAAcP,CAAC,CAACK,KAAhB,EAArC,KACKC,OAAO,CAACC,KAAR,CAAcP,CAAd;AACL;AACA;;AACDP,IAAAA,MAAM,GAAG,IAAT;AACAE,IAAAA,aAAa,GAAG,IAAhB;AACAJ,IAAAA,QAAQ,CAACS,CAAD,CAAR;AACA;AAED;;AAED,SAASQ,WAAT,CAAqBlB,IAArB,EAA2BrB,GAA3B,EAAgC;AAC/B,MAAG,CAACA,GAAD,IAAQwC,MAAM,CAACC,QAAP,CAAgBpB,IAAI,CAAC,CAAD,CAApB,CAAX,EACCA,IAAI,CAAC,CAAD,CAAJ,GAAUnD,kBAAkB,CAACmD,IAAI,CAAC,CAAD,CAAL,CAA5B,CADD,KAEK,IAAGrB,GAAG,IAAI,OAAOqB,IAAI,CAAC,CAAD,CAAX,KAAmB,QAA7B,EACJA,IAAI,CAAC,CAAD,CAAJ,GAAUmB,MAAM,CAACE,IAAP,CAAYrB,IAAI,CAAC,CAAD,CAAhB,EAAqB,OAArB,CAAV;AACD;;AAED,SAASsB,sBAAT,CAAgC/C,OAAhC,EAAyCgD,aAAzC,EAAwDtB,QAAxD,EAAkE;AACjE;AACA,MAAGsB,aAAa,CAACC,WAAd,IAA6BD,aAAa,CAACE,OAAd,CAAsBC,MAAtD,EACC,OAAOC,eAAe,CAACpD,OAAD,EAAUgD,aAAV,EAAyBtB,QAAzB,CAAtB;AAED,MAAI2B,mBAAmB,GAAGL,aAAa,CAACE,OAAd,CAAsBF,aAAa,CAACC,WAApC,CAA1B,CALiE,CAOjE;;AACA,MAAGI,mBAAmB,CAAC/C,aAAvB,EAAsC;AACrC0C,IAAAA,aAAa,CAACC,WAAd;AACA,WAAOF,sBAAsB,CAAC/C,OAAD,EAAUgD,aAAV,EAAyBtB,QAAzB,CAA7B;AACA,GAXgE,CAajE;;;AACArD,EAAAA,UAAU,CAACgF,mBAAD,EAAsB,UAASC,GAAT,EAAc;AAC7C,QAAGA,GAAH,EAAQ;AACPN,MAAAA,aAAa,CAACO,SAAd,CAAwB,KAAxB;AACA,aAAO7B,QAAQ,CAAC4B,GAAD,CAAf;AACA;;AACD,QAAI/B,EAAE,GAAG8B,mBAAmB,CAAClD,KAA7B;AACAkD,IAAAA,mBAAmB,CAAC/C,aAApB,GAAoC,IAApC;AACA,QAAG,CAACiB,EAAJ,EAAQ,OAAOwB,sBAAsB,CAAC/C,OAAD,EAAUgD,aAAV,EAAyBtB,QAAzB,CAA7B;AAERJ,IAAAA,cAAc,CACbC,EADa,EAEbyB,aAFa,EAEE,CAACA,aAAa,CAACQ,gBAAf,EAAiCR,aAAa,CAACS,eAA/C,EAAgEJ,mBAAmB,CAAChD,IAApB,GAA2B,EAA3F,CAFF,EAGb,UAASiD,GAAT,EAAc;AACb,UAAGA,GAAH,EAAQ,OAAO5B,QAAQ,CAAC4B,GAAD,CAAf;AACR,UAAI7B,IAAI,GAAGiC,KAAK,CAACC,SAAN,CAAgBC,KAAhB,CAAsBC,IAAtB,CAA2B3B,SAA3B,EAAsC,CAAtC,CAAX,CAFa,CAGb;AACA;AACA;;AACA,UAAI4B,MAAM,GAAGrC,IAAI,CAACsC,IAAL,CAAU,UAASlD,KAAT,EAAgB;AACtC,eAAOA,KAAK,KAAKE,SAAjB;AACA,OAFY,CAAb;;AAGA,UAAG+C,MAAH,EAAW;AACVd,QAAAA,aAAa,CAACC,WAAd;AACAe,QAAAA,oBAAoB,CAAChE,OAAD,EAAUgD,aAAV,EAAyBvB,IAAzB,EAA+BC,QAA/B,CAApB;AACA,OAHD,MAGO;AACNqB,QAAAA,sBAAsB,CAAC/C,OAAD,EAAUgD,aAAV,EAAyBtB,QAAzB,CAAtB;AACA;AACD,KAlBY,CAAd;AAoBA,GA7BS,CAAV;AA8BA;;AAED,SAAS0B,eAAT,CAAyBpD,OAAzB,EAAkCgD,aAAlC,EAAiDtB,QAAjD,EAA2D;AAC1D;AACAsB,EAAAA,aAAa,CAACC,WAAd,GAA4BD,aAAa,CAACE,OAAd,CAAsBC,MAAtB,GAA+B,CAA3D;AAEA,MAAIc,YAAY,GAAGjB,aAAa,CAACiB,YAAjC;;AACA,MAAGA,YAAH,EAAiB;AAChBjE,IAAAA,OAAO,CAACoD,eAAR,CAAwBJ,aAAxB,EAAuCiB,YAAvC,EAAqD,UAASX,GAAT,EAAcY,MAAd,EAAsB;AAC1E,UAAGZ,GAAH,EAAQ,OAAO5B,QAAQ,CAAC4B,GAAD,CAAf;AACRtD,MAAAA,OAAO,CAACmE,cAAR,GAAyBD,MAAzB;AACAF,MAAAA,oBAAoB,CAAChE,OAAD,EAAUgD,aAAV,EAAyB,CAACkB,MAAD,CAAzB,EAAmCxC,QAAnC,CAApB;AACA,KAJD;AAKA,GAND,MAMO;AACNsC,IAAAA,oBAAoB,CAAChE,OAAD,EAAUgD,aAAV,EAAyB,CAAC,IAAD,CAAzB,EAAiCtB,QAAjC,CAApB;AACA;AACD;;AAED,SAASsC,oBAAT,CAA8BhE,OAA9B,EAAuCgD,aAAvC,EAAsDvB,IAAtD,EAA4DC,QAA5D,EAAsE;AACrE,MAAGsB,aAAa,CAACC,WAAd,GAA4B,CAA/B,EACC,OAAOvB,QAAQ,CAAC,IAAD,EAAOD,IAAP,CAAf;AAED,MAAI4B,mBAAmB,GAAGL,aAAa,CAACE,OAAd,CAAsBF,aAAa,CAACC,WAApC,CAA1B,CAJqE,CAMrE;;AACA,MAAGI,mBAAmB,CAAC9C,cAAvB,EAAuC;AACtCyC,IAAAA,aAAa,CAACC,WAAd;AACA,WAAOe,oBAAoB,CAAChE,OAAD,EAAUgD,aAAV,EAAyBvB,IAAzB,EAA+BC,QAA/B,CAA3B;AACA;;AAED,MAAIH,EAAE,GAAG8B,mBAAmB,CAACnD,MAA7B;AACAmD,EAAAA,mBAAmB,CAAC9C,cAApB,GAAqC,IAArC;;AACA,MAAG,CAACgB,EAAJ,EAAQ;AACP,WAAOyC,oBAAoB,CAAChE,OAAD,EAAUgD,aAAV,EAAyBvB,IAAzB,EAA+BC,QAA/B,CAA3B;AACA;;AAEDiB,EAAAA,WAAW,CAAClB,IAAD,EAAO4B,mBAAmB,CAACjD,GAA3B,CAAX;AAEAkB,EAAAA,cAAc,CAACC,EAAD,EAAKyB,aAAL,EAAoBvB,IAApB,EAA0B,UAAS6B,GAAT,EAAc;AACrD,QAAGA,GAAH,EAAQ,OAAO5B,QAAQ,CAAC4B,GAAD,CAAf;AAER,QAAI7B,IAAI,GAAGiC,KAAK,CAACC,SAAN,CAAgBC,KAAhB,CAAsBC,IAAtB,CAA2B3B,SAA3B,EAAsC,CAAtC,CAAX;AACA8B,IAAAA,oBAAoB,CAAChE,OAAD,EAAUgD,aAAV,EAAyBvB,IAAzB,EAA+BC,QAA/B,CAApB;AACA,GALa,CAAd;AAMA;;AAED0C,OAAO,CAACC,UAAR,GAAqB,SAASA,UAAT,CAAoBC,QAApB,EAA8B;AAClD,MAAItF,IAAI,GAAGH,sBAAsB,CAACyF,QAAD,CAAtB,CAAiCtF,IAA5C;AACA,SAAOI,OAAO,CAACJ,IAAD,CAAd;AACA,CAHD;;AAKAoF,OAAO,CAACG,UAAR,GAAqB,SAASA,UAAT,CAAoBvE,OAApB,EAA6B0B,QAA7B,EAAuC;AAC3D;AACA,MAAI4C,QAAQ,GAAGtE,OAAO,CAACsE,QAAR,IAAoB,EAAnC;AACA,MAAIpB,OAAO,GAAGlD,OAAO,CAACkD,OAAR,IAAmB,EAAjC;AACA,MAAIF,aAAa,GAAGhD,OAAO,CAACwB,OAAR,IAAmB,EAAvC;;AACA,MAAI4B,eAAe,GAAGpD,OAAO,CAACoD,eAAR,IAA2B,CAAC,CAACoB,YAAD,EAAehD,OAAf,EAAwB8C,QAAxB,EAAkC5C,QAAlC,KAA+C;AAChGF,IAAAA,OAAO,CAACiD,aAAR,CAAsBH,QAAtB;AACAE,IAAAA,YAAY,CAACF,QAAD,EAAW5C,QAAX,CAAZ;AACA,GAHgD,EAG9CtD,IAH8C,CAGzC,IAHyC,EAGnC4B,OAAO,CAACwE,YAAR,IAAwBrG,QAHW,CAAjD,CAL2D,CAU3D;;;AACA,MAAIuG,gBAAgB,GAAGJ,QAAQ,IAAIzF,sBAAsB,CAACyF,QAAD,CAAzD;AACA,MAAIL,YAAY,GAAGS,gBAAgB,GAAGA,gBAAgB,CAAC1F,IAApB,GAA2B+B,SAA9D;AACA,MAAI4D,aAAa,GAAGD,gBAAgB,GAAGA,gBAAgB,CAACxF,KAApB,GAA4B6B,SAAhE;AACA,MAAI6D,gBAAgB,GAAGF,gBAAgB,GAAGA,gBAAgB,CAACvF,QAApB,GAA+B4B,SAAtE;AACA,MAAI8D,gBAAgB,GAAGZ,YAAY,GAAG7E,OAAO,CAAC6E,YAAD,CAAV,GAA2B,IAA9D,CAf2D,CAiB3D;;AACA,MAAIa,gBAAgB,GAAG,IAAvB;AACA,MAAIC,gBAAgB,GAAG,EAAvB;AACA,MAAIC,mBAAmB,GAAG,EAA1B;AACA,MAAIC,mBAAmB,GAAG,EAA1B,CArB2D,CAuB3D;;AACA/B,EAAAA,OAAO,GAAGA,OAAO,CAACgC,GAAR,CAAYrF,kBAAZ,CAAV;AAEAmD,EAAAA,aAAa,CAACxB,OAAd,GAAwBqD,gBAAxB;AACA7B,EAAAA,aAAa,CAACC,WAAd,GAA4B,CAA5B;AACAD,EAAAA,aAAa,CAACE,OAAd,GAAwBA,OAAxB;AACAF,EAAAA,aAAa,CAACiB,YAAd,GAA6BA,YAA7B;AACAjB,EAAAA,aAAa,CAAC2B,aAAd,GAA8BA,aAA9B;AACA3B,EAAAA,aAAa,CAAC4B,gBAAd,GAAiCA,gBAAjC;AACA5B,EAAAA,aAAa,CAACjB,KAAd,GAAsB,IAAtB;AACAiB,EAAAA,aAAa,CAACtB,QAAd,GAAyB,IAAzB;;AACAsB,EAAAA,aAAa,CAACO,SAAd,GAA0B,SAASA,SAAT,CAAmB4B,IAAnB,EAAyB;AAClD,QAAGA,IAAI,KAAK,KAAZ,EAAmB;AAClBL,MAAAA,gBAAgB,GAAG,KAAnB;AACA;AACD,GAJD;;AAKA9B,EAAAA,aAAa,CAACoC,UAAd,GAA2BpC,aAAa,CAACyB,aAAd,GAA8B,SAASA,aAAT,CAAuBY,IAAvB,EAA6B;AACrFN,IAAAA,gBAAgB,CAACO,IAAjB,CAAsBD,IAAtB;AACA,GAFD;;AAGArC,EAAAA,aAAa,CAACuC,oBAAd,GAAqC,SAASA,oBAAT,CAA8B/D,OAA9B,EAAuC;AAC3EwD,IAAAA,mBAAmB,CAACM,IAApB,CAAyB9D,OAAzB;AACA,GAFD;;AAGAwB,EAAAA,aAAa,CAACwC,oBAAd,GAAqC,SAASA,oBAAT,CAA8BhE,OAA9B,EAAuC;AAC3EyD,IAAAA,mBAAmB,CAACK,IAApB,CAAyB9D,OAAzB;AACA,GAFD;;AAGAwB,EAAAA,aAAa,CAACyC,eAAd,GAAgC,SAASA,eAAT,GAA2B;AAC1D,WAAOV,gBAAgB,CAACnB,KAAjB,EAAP;AACA,GAFD;;AAGAZ,EAAAA,aAAa,CAAC0C,sBAAd,GAAuC,SAASA,sBAAT,GAAkC;AACxE,WAAOV,mBAAmB,CAACpB,KAApB,EAAP;AACA,GAFD;;AAGAZ,EAAAA,aAAa,CAAC2C,sBAAd,GAAuC,SAASA,sBAAT,GAAkC;AACxE,WAAOV,mBAAmB,CAACrB,KAApB,EAAP;AACA,GAFD;;AAGAZ,EAAAA,aAAa,CAAC4C,iBAAd,GAAkC,SAASA,iBAAT,GAA6B;AAC9Db,IAAAA,gBAAgB,CAAC5B,MAAjB,GAA0B,CAA1B;AACA6B,IAAAA,mBAAmB,CAAC7B,MAApB,GAA6B,CAA7B;AACA8B,IAAAA,mBAAmB,CAAC9B,MAApB,GAA6B,CAA7B;AACA2B,IAAAA,gBAAgB,GAAG,IAAnB;AACA,GALD;;AAMAtE,EAAAA,MAAM,CAACC,cAAP,CAAsBuC,aAAtB,EAAqC,UAArC,EAAiD;AAChDtC,IAAAA,UAAU,EAAE,IADoC;AAEhDC,IAAAA,GAAG,EAAE,YAAW;AACf,UAAGqC,aAAa,CAACiB,YAAd,KAA+BlD,SAAlC,EACC,OAAOA,SAAP;AACD,aAAOiC,aAAa,CAACiB,YAAd,CAA2BhF,OAA3B,CAAmC,IAAnC,EAAyC,KAAzC,IAAkD+D,aAAa,CAAC2B,aAAd,CAA4B1F,OAA5B,CAAoC,IAApC,EAA0C,KAA1C,CAAlD,GAAqG+D,aAAa,CAAC4B,gBAA1H;AACA,KAN+C;AAOhDhE,IAAAA,GAAG,EAAE,UAASC,KAAT,EAAgB;AACpB,UAAI6D,gBAAgB,GAAG7D,KAAK,IAAIhC,sBAAsB,CAACgC,KAAD,CAAtD;AACAmC,MAAAA,aAAa,CAACiB,YAAd,GAA6BS,gBAAgB,GAAGA,gBAAgB,CAAC1F,IAApB,GAA2B+B,SAAxE;AACAiC,MAAAA,aAAa,CAAC2B,aAAd,GAA8BD,gBAAgB,GAAGA,gBAAgB,CAACxF,KAApB,GAA4B6B,SAA1E;AACAiC,MAAAA,aAAa,CAAC4B,gBAAd,GAAiCF,gBAAgB,GAAGA,gBAAgB,CAACvF,QAApB,GAA+B4B,SAAhF;AACA;AAZ+C,GAAjD;AAcAP,EAAAA,MAAM,CAACC,cAAP,CAAsBuC,aAAtB,EAAqC,SAArC,EAAgD;AAC/CtC,IAAAA,UAAU,EAAE,IADmC;AAE/CC,IAAAA,GAAG,EAAE,YAAW;AACf,aAAOqC,aAAa,CAACE,OAAd,CAAsBgC,GAAtB,CAA0B,UAASW,CAAT,EAAY;AAC5C,eAAOA,CAAC,CAACzE,OAAT;AACA,OAFM,EAEJ0E,MAFI,CAEG9C,aAAa,CAACsB,QAAd,IAA0B,EAF7B,EAEiCyB,IAFjC,CAEsC,GAFtC,CAAP;AAGA;AAN8C,GAAhD;AAQAvF,EAAAA,MAAM,CAACC,cAAP,CAAsBuC,aAAtB,EAAqC,kBAArC,EAAyD;AACxDtC,IAAAA,UAAU,EAAE,IAD4C;AAExDC,IAAAA,GAAG,EAAE,YAAW;AACf,UAAGqC,aAAa,CAACC,WAAd,IAA6BD,aAAa,CAACE,OAAd,CAAsBC,MAAtB,GAA+B,CAA5D,IAAiE,CAACH,aAAa,CAACsB,QAAnF,EACC,OAAO,EAAP;AACD,aAAOtB,aAAa,CAACE,OAAd,CAAsBU,KAAtB,CAA4BZ,aAAa,CAACC,WAAd,GAA4B,CAAxD,EAA2DiC,GAA3D,CAA+D,UAASW,CAAT,EAAY;AACjF,eAAOA,CAAC,CAACzE,OAAT;AACA,OAFM,EAEJ0E,MAFI,CAEG9C,aAAa,CAACsB,QAAd,IAA0B,EAF7B,EAEiCyB,IAFjC,CAEsC,GAFtC,CAAP;AAGA;AARuD,GAAzD;AAUAvF,EAAAA,MAAM,CAACC,cAAP,CAAsBuC,aAAtB,EAAqC,gBAArC,EAAuD;AACtDtC,IAAAA,UAAU,EAAE,IAD0C;AAEtDC,IAAAA,GAAG,EAAE,YAAW;AACf,aAAOqC,aAAa,CAACE,OAAd,CAAsBU,KAAtB,CAA4BZ,aAAa,CAACC,WAA1C,EAAuDiC,GAAvD,CAA2D,UAASW,CAAT,EAAY;AAC7E,eAAOA,CAAC,CAACzE,OAAT;AACA,OAFM,EAEJ0E,MAFI,CAEG9C,aAAa,CAACsB,QAAd,IAA0B,EAF7B,EAEiCyB,IAFjC,CAEsC,GAFtC,CAAP;AAGA;AANqD,GAAvD;AAQAvF,EAAAA,MAAM,CAACC,cAAP,CAAsBuC,aAAtB,EAAqC,iBAArC,EAAwD;AACvDtC,IAAAA,UAAU,EAAE,IAD2C;AAEvDC,IAAAA,GAAG,EAAE,YAAW;AACf,aAAOqC,aAAa,CAACE,OAAd,CAAsBU,KAAtB,CAA4B,CAA5B,EAA+BZ,aAAa,CAACC,WAA7C,EAA0DiC,GAA1D,CAA8D,UAASW,CAAT,EAAY;AAChF,eAAOA,CAAC,CAACzE,OAAT;AACA,OAFM,EAEJ2E,IAFI,CAEC,GAFD,CAAP;AAGA;AANsD,GAAxD;AAQAvF,EAAAA,MAAM,CAACC,cAAP,CAAsBuC,aAAtB,EAAqC,OAArC,EAA8C;AAC7CtC,IAAAA,UAAU,EAAE,IADiC;AAE7CC,IAAAA,GAAG,EAAE,YAAW;AACf,UAAIqF,KAAK,GAAGhD,aAAa,CAACE,OAAd,CAAsBF,aAAa,CAACC,WAApC,CAAZ;AACA,aAAO+C,KAAK,CAAChG,OAAN,IAAiB,OAAOgG,KAAK,CAAChG,OAAb,KAAyB,QAA1C,GAAqDgG,KAAK,CAAChG,OAA3D,GAAqEgG,KAAK,CAAC9G,KAAlF;AACA;AAL4C,GAA9C;AAOAsB,EAAAA,MAAM,CAACC,cAAP,CAAsBuC,aAAtB,EAAqC,MAArC,EAA6C;AAC5CtC,IAAAA,UAAU,EAAE,IADgC;AAE5CC,IAAAA,GAAG,EAAE,YAAW;AACf,aAAOqC,aAAa,CAACE,OAAd,CAAsBF,aAAa,CAACC,WAApC,EAAiD5C,IAAxD;AACA;AAJ2C,GAA7C,EAtH2D,CA6H3D;;AACA,MAAGG,MAAM,CAACa,iBAAV,EAA6B;AAC5Bb,IAAAA,MAAM,CAACa,iBAAP,CAAyB2B,aAAzB;AACA;;AAED,MAAIiD,cAAc,GAAG;AACpB9B,IAAAA,cAAc,EAAE,IADI;AAEpBf,IAAAA,eAAe,EAAEA;AAFG,GAArB;AAIAL,EAAAA,sBAAsB,CAACkD,cAAD,EAAiBjD,aAAjB,EAAgC,UAASM,GAAT,EAAclB,MAAd,EAAsB;AAC3E,QAAGkB,GAAH,EAAQ;AACP,aAAO5B,QAAQ,CAAC4B,GAAD,EAAM;AACpBC,QAAAA,SAAS,EAAEuB,gBADS;AAEpBC,QAAAA,gBAAgB,EAAEA,gBAFE;AAGpBC,QAAAA,mBAAmB,EAAEA,mBAHD;AAIpBC,QAAAA,mBAAmB,EAAEA;AAJD,OAAN,CAAf;AAMA;;AACDvD,IAAAA,QAAQ,CAAC,IAAD,EAAO;AACdU,MAAAA,MAAM,EAAEA,MADM;AAEd+B,MAAAA,cAAc,EAAE8B,cAAc,CAAC9B,cAFjB;AAGdZ,MAAAA,SAAS,EAAEuB,gBAHG;AAIdC,MAAAA,gBAAgB,EAAEA,gBAJJ;AAKdC,MAAAA,mBAAmB,EAAEA,mBALP;AAMdC,MAAAA,mBAAmB,EAAEA;AANP,KAAP,CAAR;AAQA,GAjBqB,CAAtB;AAkBA,CAxJD","sourcesContent":["/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\nvar fs = require(\"fs\");\nvar readFile = fs.readFile.bind(fs);\nvar loadLoader = require(\"./loadLoader\");\n\nfunction utf8BufferToString(buf) {\n\tvar str = buf.toString(\"utf-8\");\n\tif(str.charCodeAt(0) === 0xFEFF) {\n\t\treturn str.substr(1);\n\t} else {\n\t\treturn str;\n\t}\n}\n\nconst PATH_QUERY_FRAGMENT_REGEXP = /^((?:\\0.|[^?#\\0])*)(\\?(?:\\0.|[^#\\0])*)?(#.*)?$/;\n\n/**\n * @param {string} str the path with query and fragment\n * @returns {{ path: string, query: string, fragment: string }} parsed parts\n */\nfunction parsePathQueryFragment(str) {\n\tvar match = PATH_QUERY_FRAGMENT_REGEXP.exec(str);\n\treturn {\n\t\tpath: match[1].replace(/\\0(.)/g, \"$1\"),\n\t\tquery: match[2] ? match[2].replace(/\\0(.)/g, \"$1\") : \"\",\n\t\tfragment: match[3] || \"\"\n\t};\n}\n\nfunction dirname(path) {\n\tif(path === \"/\") return \"/\";\n\tvar i = path.lastIndexOf(\"/\");\n\tvar j = path.lastIndexOf(\"\\\\\");\n\tvar i2 = path.indexOf(\"/\");\n\tvar j2 = path.indexOf(\"\\\\\");\n\tvar idx = i > j ? i : j;\n\tvar idx2 = i > j ? i2 : j2;\n\tif(idx < 0) return path;\n\tif(idx === idx2) return path.substr(0, idx + 1);\n\treturn path.substr(0, idx);\n}\n\nfunction createLoaderObject(loader) {\n\tvar obj = {\n\t\tpath: null,\n\t\tquery: null,\n\t\tfragment: null,\n\t\toptions: null,\n\t\tident: null,\n\t\tnormal: null,\n\t\tpitch: null,\n\t\traw: null,\n\t\tdata: null,\n\t\tpitchExecuted: false,\n\t\tnormalExecuted: false\n\t};\n\tObject.defineProperty(obj, \"request\", {\n\t\tenumerable: true,\n\t\tget: function() {\n\t\t\treturn obj.path.replace(/#/g, \"\\0#\") + obj.query.replace(/#/g, \"\\0#\") + obj.fragment;\n\t\t},\n\t\tset: function(value) {\n\t\t\tif(typeof value === \"string\") {\n\t\t\t\tvar splittedRequest = parsePathQueryFragment(value);\n\t\t\t\tobj.path = splittedRequest.path;\n\t\t\t\tobj.query = splittedRequest.query;\n\t\t\t\tobj.fragment = splittedRequest.fragment;\n\t\t\t\tobj.options = undefined;\n\t\t\t\tobj.ident = undefined;\n\t\t\t} else {\n\t\t\t\tif(!value.loader)\n\t\t\t\t\tthrow new Error(\"request should be a string or object with loader and options (\" + JSON.stringify(value) + \")\");\n\t\t\t\tobj.path = value.loader;\n\t\t\t\tobj.fragment = value.fragment || \"\";\n\t\t\t\tobj.type = value.type;\n\t\t\t\tobj.options = value.options;\n\t\t\t\tobj.ident = value.ident;\n\t\t\t\tif(obj.options === null)\n\t\t\t\t\tobj.query = \"\";\n\t\t\t\telse if(obj.options === undefined)\n\t\t\t\t\tobj.query = \"\";\n\t\t\t\telse if(typeof obj.options === \"string\")\n\t\t\t\t\tobj.query = \"?\" + obj.options;\n\t\t\t\telse if(obj.ident)\n\t\t\t\t\tobj.query = \"??\" + obj.ident;\n\t\t\t\telse if(typeof obj.options === \"object\" && obj.options.ident)\n\t\t\t\t\tobj.query = \"??\" + obj.options.ident;\n\t\t\t\telse\n\t\t\t\t\tobj.query = \"?\" + JSON.stringify(obj.options);\n\t\t\t}\n\t\t}\n\t});\n\tobj.request = loader;\n\tif(Object.preventExtensions) {\n\t\tObject.preventExtensions(obj);\n\t}\n\treturn obj;\n}\n\nfunction runSyncOrAsync(fn, context, args, callback) {\n\tvar isSync = true;\n\tvar isDone = false;\n\tvar isError = false; // internal error\n\tvar reportedError = false;\n\tcontext.async = function async() {\n\t\tif(isDone) {\n\t\t\tif(reportedError) return; // ignore\n\t\t\tthrow new Error(\"async(): The callback was already called.\");\n\t\t}\n\t\tisSync = false;\n\t\treturn innerCallback;\n\t};\n\tvar innerCallback = context.callback = function() {\n\t\tif(isDone) {\n\t\t\tif(reportedError) return; // ignore\n\t\t\tthrow new Error(\"callback(): The callback was already called.\");\n\t\t}\n\t\tisDone = true;\n\t\tisSync = false;\n\t\ttry {\n\t\t\tcallback.apply(null, arguments);\n\t\t} catch(e) {\n\t\t\tisError = true;\n\t\t\tthrow e;\n\t\t}\n\t};\n\ttry {\n\t\tvar result = (function LOADER_EXECUTION() {\n\t\t\treturn fn.apply(context, args);\n\t\t}());\n\t\tif(isSync) {\n\t\t\tisDone = true;\n\t\t\tif(result === undefined)\n\t\t\t\treturn callback();\n\t\t\tif(result && typeof result === \"object\" && typeof result.then === \"function\") {\n\t\t\t\treturn result.then(function(r) {\n\t\t\t\t\tcallback(null, r);\n\t\t\t\t}, callback);\n\t\t\t}\n\t\t\treturn callback(null, result);\n\t\t}\n\t} catch(e) {\n\t\tif(isError) throw e;\n\t\tif(isDone) {\n\t\t\t// loader is already \"done\", so we cannot use the callback function\n\t\t\t// for better debugging we print the error on the console\n\t\t\tif(typeof e === \"object\" && e.stack) console.error(e.stack);\n\t\t\telse console.error(e);\n\t\t\treturn;\n\t\t}\n\t\tisDone = true;\n\t\treportedError = true;\n\t\tcallback(e);\n\t}\n\n}\n\nfunction convertArgs(args, raw) {\n\tif(!raw && Buffer.isBuffer(args[0]))\n\t\targs[0] = utf8BufferToString(args[0]);\n\telse if(raw && typeof args[0] === \"string\")\n\t\targs[0] = Buffer.from(args[0], \"utf-8\");\n}\n\nfunction iteratePitchingLoaders(options, loaderContext, callback) {\n\t// abort after last loader\n\tif(loaderContext.loaderIndex >= loaderContext.loaders.length)\n\t\treturn processResource(options, loaderContext, callback);\n\n\tvar currentLoaderObject = loaderContext.loaders[loaderContext.loaderIndex];\n\n\t// iterate\n\tif(currentLoaderObject.pitchExecuted) {\n\t\tloaderContext.loaderIndex++;\n\t\treturn iteratePitchingLoaders(options, loaderContext, callback);\n\t}\n\n\t// load loader module\n\tloadLoader(currentLoaderObject, function(err) {\n\t\tif(err) {\n\t\t\tloaderContext.cacheable(false);\n\t\t\treturn callback(err);\n\t\t}\n\t\tvar fn = currentLoaderObject.pitch;\n\t\tcurrentLoaderObject.pitchExecuted = true;\n\t\tif(!fn) return iteratePitchingLoaders(options, loaderContext, callback);\n\n\t\trunSyncOrAsync(\n\t\t\tfn,\n\t\t\tloaderContext, [loaderContext.remainingRequest, loaderContext.previousRequest, currentLoaderObject.data = {}],\n\t\t\tfunction(err) {\n\t\t\t\tif(err) return callback(err);\n\t\t\t\tvar args = Array.prototype.slice.call(arguments, 1);\n\t\t\t\t// Determine whether to continue the pitching process based on\n\t\t\t\t// argument values (as opposed to argument presence) in order\n\t\t\t\t// to support synchronous and asynchronous usages.\n\t\t\t\tvar hasArg = args.some(function(value) {\n\t\t\t\t\treturn value !== undefined;\n\t\t\t\t});\n\t\t\t\tif(hasArg) {\n\t\t\t\t\tloaderContext.loaderIndex--;\n\t\t\t\t\titerateNormalLoaders(options, loaderContext, args, callback);\n\t\t\t\t} else {\n\t\t\t\t\titeratePitchingLoaders(options, loaderContext, callback);\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t});\n}\n\nfunction processResource(options, loaderContext, callback) {\n\t// set loader index to last loader\n\tloaderContext.loaderIndex = loaderContext.loaders.length - 1;\n\n\tvar resourcePath = loaderContext.resourcePath;\n\tif(resourcePath) {\n\t\toptions.processResource(loaderContext, resourcePath, function(err, buffer) {\n\t\t\tif(err) return callback(err);\n\t\t\toptions.resourceBuffer = buffer;\n\t\t\titerateNormalLoaders(options, loaderContext, [buffer], callback);\n\t\t});\n\t} else {\n\t\titerateNormalLoaders(options, loaderContext, [null], callback);\n\t}\n}\n\nfunction iterateNormalLoaders(options, loaderContext, args, callback) {\n\tif(loaderContext.loaderIndex < 0)\n\t\treturn callback(null, args);\n\n\tvar currentLoaderObject = loaderContext.loaders[loaderContext.loaderIndex];\n\n\t// iterate\n\tif(currentLoaderObject.normalExecuted) {\n\t\tloaderContext.loaderIndex--;\n\t\treturn iterateNormalLoaders(options, loaderContext, args, callback);\n\t}\n\n\tvar fn = currentLoaderObject.normal;\n\tcurrentLoaderObject.normalExecuted = true;\n\tif(!fn) {\n\t\treturn iterateNormalLoaders(options, loaderContext, args, callback);\n\t}\n\n\tconvertArgs(args, currentLoaderObject.raw);\n\n\trunSyncOrAsync(fn, loaderContext, args, function(err) {\n\t\tif(err) return callback(err);\n\n\t\tvar args = Array.prototype.slice.call(arguments, 1);\n\t\titerateNormalLoaders(options, loaderContext, args, callback);\n\t});\n}\n\nexports.getContext = function getContext(resource) {\n\tvar path = parsePathQueryFragment(resource).path;\n\treturn dirname(path);\n};\n\nexports.runLoaders = function runLoaders(options, callback) {\n\t// read options\n\tvar resource = options.resource || \"\";\n\tvar loaders = options.loaders || [];\n\tvar loaderContext = options.context || {};\n\tvar processResource = options.processResource || ((readResource, context, resource, callback) => {\n\t\tcontext.addDependency(resource);\n\t\treadResource(resource, callback);\n\t}).bind(null, options.readResource || readFile);\n\n\t//\n\tvar splittedResource = resource && parsePathQueryFragment(resource);\n\tvar resourcePath = splittedResource ? splittedResource.path : undefined;\n\tvar resourceQuery = splittedResource ? splittedResource.query : undefined;\n\tvar resourceFragment = splittedResource ? splittedResource.fragment : undefined;\n\tvar contextDirectory = resourcePath ? dirname(resourcePath) : null;\n\n\t// execution state\n\tvar requestCacheable = true;\n\tvar fileDependencies = [];\n\tvar contextDependencies = [];\n\tvar missingDependencies = [];\n\n\t// prepare loader objects\n\tloaders = loaders.map(createLoaderObject);\n\n\tloaderContext.context = contextDirectory;\n\tloaderContext.loaderIndex = 0;\n\tloaderContext.loaders = loaders;\n\tloaderContext.resourcePath = resourcePath;\n\tloaderContext.resourceQuery = resourceQuery;\n\tloaderContext.resourceFragment = resourceFragment;\n\tloaderContext.async = null;\n\tloaderContext.callback = null;\n\tloaderContext.cacheable = function cacheable(flag) {\n\t\tif(flag === false) {\n\t\t\trequestCacheable = false;\n\t\t}\n\t};\n\tloaderContext.dependency = loaderContext.addDependency = function addDependency(file) {\n\t\tfileDependencies.push(file);\n\t};\n\tloaderContext.addContextDependency = function addContextDependency(context) {\n\t\tcontextDependencies.push(context);\n\t};\n\tloaderContext.addMissingDependency = function addMissingDependency(context) {\n\t\tmissingDependencies.push(context);\n\t};\n\tloaderContext.getDependencies = function getDependencies() {\n\t\treturn fileDependencies.slice();\n\t};\n\tloaderContext.getContextDependencies = function getContextDependencies() {\n\t\treturn contextDependencies.slice();\n\t};\n\tloaderContext.getMissingDependencies = function getMissingDependencies() {\n\t\treturn missingDependencies.slice();\n\t};\n\tloaderContext.clearDependencies = function clearDependencies() {\n\t\tfileDependencies.length = 0;\n\t\tcontextDependencies.length = 0;\n\t\tmissingDependencies.length = 0;\n\t\trequestCacheable = true;\n\t};\n\tObject.defineProperty(loaderContext, \"resource\", {\n\t\tenumerable: true,\n\t\tget: function() {\n\t\t\tif(loaderContext.resourcePath === undefined)\n\t\t\t\treturn undefined;\n\t\t\treturn loaderContext.resourcePath.replace(/#/g, \"\\0#\") + loaderContext.resourceQuery.replace(/#/g, \"\\0#\") + loaderContext.resourceFragment;\n\t\t},\n\t\tset: function(value) {\n\t\t\tvar splittedResource = value && parsePathQueryFragment(value);\n\t\t\tloaderContext.resourcePath = splittedResource ? splittedResource.path : undefined;\n\t\t\tloaderContext.resourceQuery = splittedResource ? splittedResource.query : undefined;\n\t\t\tloaderContext.resourceFragment = splittedResource ? splittedResource.fragment : undefined;\n\t\t}\n\t});\n\tObject.defineProperty(loaderContext, \"request\", {\n\t\tenumerable: true,\n\t\tget: function() {\n\t\t\treturn loaderContext.loaders.map(function(o) {\n\t\t\t\treturn o.request;\n\t\t\t}).concat(loaderContext.resource || \"\").join(\"!\");\n\t\t}\n\t});\n\tObject.defineProperty(loaderContext, \"remainingRequest\", {\n\t\tenumerable: true,\n\t\tget: function() {\n\t\t\tif(loaderContext.loaderIndex >= loaderContext.loaders.length - 1 && !loaderContext.resource)\n\t\t\t\treturn \"\";\n\t\t\treturn loaderContext.loaders.slice(loaderContext.loaderIndex + 1).map(function(o) {\n\t\t\t\treturn o.request;\n\t\t\t}).concat(loaderContext.resource || \"\").join(\"!\");\n\t\t}\n\t});\n\tObject.defineProperty(loaderContext, \"currentRequest\", {\n\t\tenumerable: true,\n\t\tget: function() {\n\t\t\treturn loaderContext.loaders.slice(loaderContext.loaderIndex).map(function(o) {\n\t\t\t\treturn o.request;\n\t\t\t}).concat(loaderContext.resource || \"\").join(\"!\");\n\t\t}\n\t});\n\tObject.defineProperty(loaderContext, \"previousRequest\", {\n\t\tenumerable: true,\n\t\tget: function() {\n\t\t\treturn loaderContext.loaders.slice(0, loaderContext.loaderIndex).map(function(o) {\n\t\t\t\treturn o.request;\n\t\t\t}).join(\"!\");\n\t\t}\n\t});\n\tObject.defineProperty(loaderContext, \"query\", {\n\t\tenumerable: true,\n\t\tget: function() {\n\t\t\tvar entry = loaderContext.loaders[loaderContext.loaderIndex];\n\t\t\treturn entry.options && typeof entry.options === \"object\" ? entry.options : entry.query;\n\t\t}\n\t});\n\tObject.defineProperty(loaderContext, \"data\", {\n\t\tenumerable: true,\n\t\tget: function() {\n\t\t\treturn loaderContext.loaders[loaderContext.loaderIndex].data;\n\t\t}\n\t});\n\n\t// finish loader context\n\tif(Object.preventExtensions) {\n\t\tObject.preventExtensions(loaderContext);\n\t}\n\n\tvar processOptions = {\n\t\tresourceBuffer: null,\n\t\tprocessResource: processResource\n\t};\n\titeratePitchingLoaders(processOptions, loaderContext, function(err, result) {\n\t\tif(err) {\n\t\t\treturn callback(err, {\n\t\t\t\tcacheable: requestCacheable,\n\t\t\t\tfileDependencies: fileDependencies,\n\t\t\t\tcontextDependencies: contextDependencies,\n\t\t\t\tmissingDependencies: missingDependencies\n\t\t\t});\n\t\t}\n\t\tcallback(null, {\n\t\t\tresult: result,\n\t\t\tresourceBuffer: processOptions.resourceBuffer,\n\t\t\tcacheable: requestCacheable,\n\t\t\tfileDependencies: fileDependencies,\n\t\t\tcontextDependencies: contextDependencies,\n\t\t\tmissingDependencies: missingDependencies\n\t\t});\n\t});\n};\n"]},"metadata":{},"sourceType":"script"}